<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>User's Guide to the Community Atmosphere Model CAM-5.3</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="book"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="BOOK"
><A
NAME="AEN1"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="title"
><A
NAME="AEN2"
>User's Guide to the Community Atmosphere Model CAM-5.3</A
></H1
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="#acknow"
>Acknowledgments</A
></DT
><DT
>1. <A
HREF="#intro"
>Introduction</A
></DT
><DD
><DL
><DT
><A
HREF="#whats_new"
>Changes from previous release</A
></DT
><DT
><A
HREF="#help"
>Getting Help -- Other User Resources</A
></DT
><DD
><DL
><DT
><A
HREF="#cam_homepage"
>The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> Web Page</A
></DT
><DT
><A
HREF="#cam_bb"
>The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Bulletin Board</A
></DT
><DT
><A
HREF="#cam_bugs"
>Reporting bugs</A
></DT
></DL
></DD
></DL
></DD
><DT
>2. <A
HREF="#bld_run_cam"
>Building and Running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
></A
></DT
><DD
><DL
><DT
><A
HREF="#interactive_session"
>Sample Interactive Session</A
></DT
><DD
><DL
><DT
><A
HREF="#config_serial"
>Configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for serial execution</A
></DT
><DT
><A
HREF="#config_fc"
>Specifying the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler</A
></DT
><DT
><A
HREF="#config_para"
>Configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for parallel execution</A
></DT
><DT
><A
HREF="#build"
>Building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
></A
></DT
><DT
><A
HREF="#bldnl_default"
>Building the Namelist</A
></DT
><DT
><A
HREF="#acquire_inputdata"
>Acquiring Input Datasets</A
></DT
><DT
><A
HREF="#run_cam"
>Running CAM</A
></DT
></DL
></DD
><DT
><A
HREF="#run_scripts"
>Sample Run Scripts</A
></DT
><DT
><A
HREF="#examples"
>Examples</A
></DT
><DT
><A
HREF="#ccsm"
>Running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> via the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#model_out"
>Model Output</A
></DT
><DD
><DL
><DT
><A
HREF="#hist_files"
>Model History Files</A
></DT
><DD
><DL
><DT
><A
HREF="#hist_fields"
>Fields Output to History Files</A
></DT
></DL
></DD
></DL
></DD
><DT
>A. <A
HREF="#config"
>The <B
CLASS="command"
>configure</B
> utility</A
></DT
><DD
><DL
><DT
><A
HREF="#config_cesm"
>How <B
CLASS="command"
>configure</B
> is called from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts</A
></DT
><DT
><A
HREF="#config_opts"
>Options to <B
CLASS="command"
>configure</B
></A
></DT
><DD
><DL
><DT
><A
HREF="#config_cam"
>CAM configuration</A
></DT
><DT
><A
HREF="#config_scam"
>SCAM configuration</A
></DT
><DT
><A
HREF="#config_parallel"
>CAM parallelization</A
></DT
><DT
><A
HREF="#config_cice"
>CICE decomposition</A
></DT
><DT
><A
HREF="#config_general"
>General options</A
></DT
><DT
><A
HREF="#config_surface_comp"
>Surface components</A
></DT
><DT
><A
HREF="#config_standalone_bld"
>CAM standalone build</A
></DT
></DL
></DD
><DT
><A
HREF="#config_env"
>Environment variables recognized by <B
CLASS="command"
>configure</B
></A
></DT
></DL
></DD
><DT
>B. <A
HREF="#bldnl"
>The <B
CLASS="command"
>build-namelist</B
> utility</A
></DT
><DD
><DL
><DT
><A
HREF="#bldnl_opts"
>Options to <B
CLASS="command"
>build-namelist</B
></A
></DT
><DT
><A
HREF="#bldnl_env"
>Environment variables used by <B
CLASS="command"
>build-namelist</B
></A
></DT
></DL
></DD
><DT
>C. <A
HREF="#cam_namelist_ref"
><ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> Namelist Variables</A
></DT
></DL
></DIV
><DIV
CLASS="preface"
><HR><H1
><A
NAME="acknow"
></A
>Acknowledgments</H1
><P
>&#13;We wish to acknowledge members of NCAR's Atmospheric Modeling and
Predictability Section (AMP), CESM Software Engineering Group
(CSEG), and Computation and Information Systems Laboratory (CISL) for their
contributions to the development of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3.
</P
><P
>&#13;The new model would not exist without the significant input from members of
the CESM Atmospheric Model Working Group (AMWG) too numerous to
mention. Rich Neale (NCAR), Minghua Zhang (SUNY), Mark Taylor (SNL) and Leo
Donner (GFDL), were co-chairs of the AMWG during part or all of the
development of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3.
</P
><P
>&#13;We would like to acknowledge the substantial contributions to the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
effort from the National Science Foundation, the Department of Energy, the
National Oceanic and Atmospheric Administration, and the National
Aeronautics and Space Administration.
</P
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="intro"
></A
>Chapter 1. Introduction</H1
><P
>&#13;The Community Atmosphere Model version <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3 is released as the
atmosphere component of the Community Earth System Model version
<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2.  It is the latest in a series of global atmosphere models
whose development is guided by
the <A
HREF="../../../../../www.cesm.ucar.edu/working_groups/Atmosphere/default.htm"
TARGET="_top"
> Atmosphere Model Working
Group</A
> (<ACRONYM
CLASS="acronym"
>AMWG</ACRONYM
>) of the
<A
HREF="../../../../../www.cesm.ucar.edu/models/cesm1.html"
TARGET="_top"
>&#13;Community Earth System Model</A
> (<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>) project.
<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is used as both a standalone
model and as the atmospheric component of the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>.
<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> has a long history of use as a standalone model by
which we mean that the atmosphere is coupled to an active land model
(<ACRONYM
CLASS="acronym"
>CLM</ACRONYM
>), a thermodynamic only sea ice model (<ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>), and a data ocean
model (<ACRONYM
CLASS="acronym"
>DOCN</ACRONYM
>).  When one speaks of "doing <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> simulations" the
implication is that it's a standalone configuration that is being used.
When <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is coupled to active ocean and sea ice models then we refer to
the model as <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>.
</P
><P
>&#13;<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> provides a framework for running the "Whole Atmosphere"
configurations; <ACRONYM
CLASS="acronym"
>WACCM</ACRONYM
>, and <ACRONYM
CLASS="acronym"
>WACCM-X</ACRONYM
>.  To run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> in a <ACRONYM
CLASS="acronym"
>WACCM</ACRONYM
> or
<ACRONYM
CLASS="acronym"
>WACCM-X</ACRONYM
> configuration the user is referred to
the <A
HREF="../../../../cesm1.2/cesm/doc/usersguide/book1.html"
TARGET="_top"
> <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2
User's Guide</A
>.
</P
><P
>&#13;In versions of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> before 4.0 the driver for the standalone configuration
was completely separate code from what was used to couple the components of
the <ACRONYM
CLASS="acronym"
>CCSM</ACRONYM
>.  One of the most significant software changes in <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-4.0 was
a refactoring of how the land, ocean, and sea ice components are called
which enabled the use of the <ACRONYM
CLASS="acronym"
>CCSM</ACRONYM
> coupler to act as the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone
driver (this also depended on the complete rewritting of the <ACRONYM
CLASS="acronym"
>CCSM</ACRONYM
> coupler
to support sequential execution of the components).  Hence, for the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>1
model, just as for <ACRONYM
CLASS="acronym"
>CCSM</ACRONYM
>4 before it, it is accurate to say that a <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
standalone configuration is nothing more than a special configuration of
<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> in which the active ocean and sea ice components are replaced by
data ocean and thermodynamic sea ice components.
</P
><P
>&#13;Since the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone model is just a special configuration of <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
it can be run using the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts.  This is done by using one of the
"F" compsets and is described in the 
<A
HREF="../../../../cesm1.2/cesm/doc/usersguide/book1.html"
TARGET="_top"
>&#13;<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2 User's Guide</A
>.  The main advantage of running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> via
the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts is to leverage the high level of support that those
scripts provide for doing production runs of predefined experiments on
supported platforms.  The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts do things like: setting up
reasonable runtime environments; automatically retrieving required input
datasets from an SVN server; and archiving output files.  But <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is used
in a lot of environments where the complexity of production ready scripts is
not necessary.  In these instances the flexibility and simplicity of
being able to completely describe a run using a short shell script is a
valuable option.  In either case though, the ability to customize a <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
build or runtime configuration depends on being able to use the utilities
described in this document.  Any build configuration can be set up via
appropriate commandline arguments to <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> utility, and any
runtime configuration can be set up with appropriate arguments to <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s
<B
CLASS="command"
>build-namelist</B
> utility.  Issues that are specific to running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
scripts will not be discussed in this guide.  Rather we focus on issues
that are independent of which scripts are used to run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>, although there
is some attention given in this guide to the construction of simple scripts
designed for running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> in its standalone mode.
</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="whats_new"
>Changes from previous release</A
></H2
><P
>&#13;This information is available from the
<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2 <A
HREF="../../../../../www.cesm.ucar.edu/models/cesm1.html"
TARGET="_top"
>home page</A
>.

<P
></P
><UL
><LI
><P
>&#13;<A
HREF="../../../../cesm1.2/tags/cesm1_2/whatsnew_science.html"
TARGET="_top"
>New science features in <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3</A
>.
</P
></LI
><LI
><P
>&#13;<A
HREF="../../../../cesm1.2/tags/cesm1_2/whatsnew_software.html"
TARGET="_top"
>New software features in <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3</A
>.
</P
></LI
><LI
><P
>&#13;<A
HREF="../../../../cesm1.2/tags/cesm1_2/answerchanges.html"
TARGET="_top"
>Summary of
answer changes</A
>.
</P
></LI
><LI
><P
>&#13;<A
HREF="../../../../cesm1.2/tags/cesm1_2/knownproblems.html"
TARGET="_top"
>Known problems</A
>.
</P
></LI
></UL
>

</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="help"
>Getting Help -- Other User Resources</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
NAME="cam_homepage"
>The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> Web Page</A
></H3
><P
>&#13;The central source for information on <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is the 
<A
HREF="../../../../cesm1.2/cam/default.htm"
TARGET="_top"
><ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> web page</A
>.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="cam_bb"
>The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Bulletin Board</A
></H3
><P
>&#13;The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Bulletin Board is a moderated forum for rapid
exchange of information, ideas, and topics of interest relating to the
various versions of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>. This includes sharing software
tools, datasets, programming tips and examples, as well as discussions
of questions, problems and workarounds. The primary motivation for the
establishment of this forum is to facilitate and encourage
communication between the users of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> around the world. This bulletin
board will also be used to distribute announcements related to <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>. 
</P
><P
>&#13;The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Bulletin Board is here: <A
HREF="http://bb.cgd.ucar.edu/"
TARGET="_top"
>http://bb.cgd.ucar.edu/</A
>.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="cam_bugs"
>Reporting bugs</A
></H3
><P
>&#13;If a user should encounter bugs in the code (i.e., it doesn't behave
in a way in which the documentation says it should), the problem
should be reported electronically to
the <A
HREF="http://bb.cgd.ucar.edu/"
TARGET="_top"
><ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Bulletin Board</A
>.
When writing a bug report the guiding principle should be to provide enough
information so that the bug can be reproduced.  The following list suggests
the minimal information that should be contained in the report:

<P
></P
><OL
TYPE="1"
><LI
><P
>&#13;The version number of the <ACRONYM
CLASS="acronym"
>CCSM</ACRONYM
> or <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> release that <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is part of.
</P
></LI
><LI
><P
>&#13;The architecture on which the code was built.  Include relevent information
such as the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler, <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> library, etc.
</P
></LI
><LI
><P
>&#13;The <B
CLASS="command"
>configure</B
> commandline.  If it is this command that is failing, then
report the output from this command.  It can also be very useful to run
this command with the <KBD
CLASS="userinput"
>-v</KBD
> option to turn on verbose
output. 
</P
></LI
><LI
><P
>&#13;The <B
CLASS="command"
>build-namelist</B
> commandline.  If it is this command that is failing, then
report the output from this command.  It can also be very useful to run
this command with the <KBD
CLASS="userinput"
>-v</KBD
> option to turn on verbose
output.
</P
></LI
><LI
><P
>&#13;Model printout.  Ideally this would contain a stack trace.  But it should
at least contain any error messages printed to the output log.
</P
></LI
></OL
>

Please note that <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is a research tool, and not all features contained
in the code base are supported.

</P
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="bld_run_cam"
></A
>Chapter 2. Building and Running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
></H1
><P
>&#13;This chapter describes how to build and run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> in its standalone
configuration.  We do not provide scripts that are setup to work out of the
box on a particular set of platforms.  If you would like this level of
support then consider running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts (see
<A
HREF="../../../../cesm1.2/cesm/doc/usersguide/book1.html"
TARGET="_top"
>&#13;<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2 User's Guide</A
>).  We do however provide some examples of
simple run scripts which should provide a useful starting point for writing
your own scripts (see <A
HREF="#run_scripts"
>the Section called <I
>Sample Run Scripts</I
></A
>).
</P
><P
>&#13;In order to build and run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> the following are required:

<P
></P
><UL
><LI
><P
>The source tree.  <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>-5.3
    is distributed with <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.2.  To obtain the source code go to
    the section "Acquiring the Code" on the 
    <A
HREF="../../../../cesm1.2/index.html"
TARGET="_top"
><ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
    Home Page</A
>.  When we refer to the root of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> source tree,
    this is the same directory as the root of the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> source tree.  This
    directory is refered to throughout this document as $<CODE
CLASS="envar"
>CAM_ROOT</CODE
>.
</P
></LI
><LI
><P
><ACRONYM
CLASS="acronym"
>Perl</ACRONYM
> (version 5.4 or later).
</P
></LI
><LI
><P
>A <ACRONYM
CLASS="acronym"
>GNU</ACRONYM
> version of the <B
CLASS="command"
>make</B
> utility.
</P
></LI
><LI
><P
><ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> and C compilers.  The <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler needs to
    support at least the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
>95 standard.
</P
></LI
><LI
><P
>A <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library (version 4.1.3 or later) that has the
    <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> APIs built using the same <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler that is used
    to build the rest of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> code.  This library is used extensively
    by <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> both to read input datasets and to write the output datasets.
    The <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> source code is available
    <A
HREF="http://www.unidata.ucar.edu/downloads/netcdf/"
TARGET="_top"
>here</A
>.
    We have updated the required <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library version from 3.6 to 4.1.3
    due to a recently discovered bug which affects all previous versions of
    the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library.  The bug only occurs in special circumstances
    that are not that easy to replicate, however the result is the corrupt
    files are silently created.  A more complete description of the bug is
    <A
HREF="https://www.unidata.ucar.edu/jira/browse/NCF-22"
TARGET="_top"
>here</A
>.
</P
></LI
><LI
><P
>Input datasets.  The required datasets depend on the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
    configuration.  Determining which datasets are required for any
    configuration is discussed in <A
HREF="#bldnl_default"
>the Section called <I
>Building the Namelist</I
></A
>.
    Acquiring those datasets is discussed in <A
HREF="#acquire_inputdata"
>the Section called <I
>Acquiring Input Datasets</I
></A
>.
</P
></LI
></UL
>
</P
><P
>&#13;To build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for SPMD execution it will also be necessary to have an
<ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> library (version 1 or later).  As with the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library, the
<ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> API should be build using the same <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler that is
used to build the rest of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  Otherwise linking to the library may
encounter difficulties, usually due to inconsistencies in <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> name
mangling.
</P
><P
>&#13;Building and running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> takes place in the following steps:
</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Configure model</P
></LI
><LI
><P
>Build model</P
></LI
><LI
><P
>Build namelist</P
></LI
><LI
><P
>Execute model</P
></LI
></OL
><DIV
CLASS="formalpara"
><P
><B
>Configure model. </B
>
This step is accomplished by running
the <B
CLASS="command"
>configure</B
> utility to set the compile-time parameters such as the
dynamical core (Eulerian Spectral, Semi-Lagrangian Spectral, Finite Volume,
or Spectral Element), horizontal grid resolution, and the type of parallelism to
employ (shared-memory and/or distributed memory).  The <B
CLASS="command"
>configure</B
> utility
is discussed in <A
HREF="#config"
>Appendix A</A
>.
</P
></DIV
><DIV
CLASS="formalpara"
><P
><B
>Build model. </B
>
This step includes compiling and linking
the executable using the <ACRONYM
CLASS="acronym"
>GNU</ACRONYM
> make command (<B
CLASS="command"
>gmake</B
>). <B
CLASS="command"
>configure</B
> creates
a Makefile in the directory where the build is to take place. The user then
need only change to this directory and execute the <B
CLASS="command"
>gmake</B
> command.
</P
></DIV
><DIV
CLASS="formalpara"
><P
><B
>Build namelist. </B
>
This step is accomplished by running the
<B
CLASS="command"
>build-namelist</B
> utility, which supports a variety of options to control the
run-time behavior of the model.  Any namelist variable recognized by <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
can be changed by the user via the <B
CLASS="command"
>build-namelist</B
> interface.  There is also a high
level "use case" functionality which makes it easy for the user to specify
a consistent set of namelist variable settings for running particular types
of experiments.  The <B
CLASS="command"
>build-namelist</B
> utility is discussed in
<A
HREF="#bldnl"
>Appendix B</A
>.
</P
></DIV
><DIV
CLASS="formalpara"
><P
><B
>Execute model. </B
>
This step includes the actual invocation
of the executable. When running using distributed memory parallelism this
step requires knowledge of how your machine invokes (or "launches") <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> executables. When
running with shared-memory parallelism (using <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
>) you may also set the number of
<ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
> threads.  On most HPC platforms access to the compute resource is
through a batch queue system.  The sample run scripts discussed in
<A
HREF="#run_scripts"
>the Section called <I
>Sample Run Scripts</I
></A
> show how to set the batch queue resources on
several HPC platforms.
</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="interactive_session"
>Sample Interactive Session</A
></H2
><P
>&#13;The following sections present an interactive C shell session to build and
run a default version of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  Most often these steps will be
encapsulated in shell scripts.  An important advantage of using a script is
that it acts to document the run you've done.  Knowing the source code
tree, and the <B
CLASS="command"
>configure</B
> and <B
CLASS="command"
>build-namelist</B
> commands provides all the information
needed to replicate a run.
</P
><P
>&#13;For the interactive session the shell variable <TT
CLASS="filename"
>camcfg</TT
> is set to the
directory in the source tree that contains the CAM <B
CLASS="command"
>configure</B
> and <B
CLASS="command"
>build-namelist</B
>
utilities ($<CODE
CLASS="envar"
>CAM_ROOT</CODE
>/models/atm/cam/bld).
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;Much of the example code in this document is set off in sections like this.
Many examples refer to files in the distribution source tree using
filepaths that are relative to distribution root directory, which we
denote, using a UNIX shell syntax, by $CAM_ROOT.  The notation indicates
that <CODE
CLASS="envar"
>CAM_ROOT</CODE
> is a shell variable that contains the filepath.  This could
just as accurately be referred to as $CCSMROOT since the root directory of
the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> distribution is the same as the root of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> distribution
which is contained within it.
</PRE
></TD
></TR
></TABLE
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_serial"
>Configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for serial execution</A
></H3
><P
>&#13;We start by changing into the directory in which the CAM executable will be
built, and then setting the environment variables <CODE
CLASS="envar"
>INC_NETCDF</CODE
> and <CODE
CLASS="envar"
>LIB_NETCDF</CODE
> which
specify the locations of the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> include files and library.  This
information is required by <B
CLASS="command"
>configure</B
> in order for it to produce the
<TT
CLASS="filename"
>Makefile</TT
>.  The <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library is require by all <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> builds.  The
directories given are just examples; the locations of the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> include
files and library are system dependent.  The information provided by these
environment variables could alternatively be provided via the commandline
arguments <KBD
CLASS="userinput"
>-nc_inc</KBD
> and <KBD
CLASS="userinput"
>-nc_lib</KBD
>.
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% cd /work/user/cam_test/bld
% setenv INC_NETCDF /usr/local/include
% setenv LIB_NETCDF /usr/local/lib
</PRE
></TD
></TR
></TABLE
><P
>&#13;Next we issue the <B
CLASS="command"
>configure</B
> command (see the example just below).  The argument
<KBD
CLASS="userinput"
>-dyn fv</KBD
> specifies using the FV dynamical core
which is the default for <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>5, but we recommend always adding the
dynamical core (dycore for short) argument to <B
CLASS="command"
>configure</B
> commands for clarity.  The argument 
<KBD
CLASS="userinput"
>-hgrid 10x15</KBD
> specifies the horizontal grid.  This is
the coarsest grid available for the FV dycore in <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> and is often useful
for testing purposes.
</P
><P
>&#13;We recommend using the <KBD
CLASS="userinput"
>-test</KBD
> option the first time
CAM is built on any machine.  This will check that the environment is
properly set up so that the Fortran compiler works and can successfully
link to the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> and <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> (if SPMD is enabled) libraries.
Furthermore, if the configuration is for serial execution, then the tests
will include both build and run phases which may be useful in exposing run
time problems that don't show up during the build, for example when shared
libraries are linked dynamically.  If any tests fail then it is useful to
rerun the <B
CLASS="command"
>configure</B
> command and add the <KBD
CLASS="userinput"
>-v</KBD
> option
which will produce verbose output of all aspects of the configuration
process including the tests.  If the configuration is for an SPMD build,
then no attempt to run the tests will be made.  Typically <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> runs must
be submitted to a batch queue and are not enabled from interactive
sessions.  Also the method of launching an <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> job is system dependent.
But the build and static linking will still be tested.
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/configure -dyn fv -hgrid 10x15 -nospmd -nosmp -test 
Issuing command to the CICE configure utility:
  $CAM_ROOT/models/ice/cice/bld/configure -hgrid 10x15 -cice_mode prescribed \
  -ntr_aero 0 -nx 24 -ny 19 -bsizex 6 -bsizey 19 -maxblocks 4 -decomptype blkrobin \
  -cache config_cache_cice.xml -cachedir /work/user/cam_test/bld
CICE configure done.
MCT configure is done.
creating /work/user/cam_test/bld/Filepath
creating /work/user/cam_test/bld/Makefile
creating /work/user/cam_test/bld/config.h
creating /work/user/cam_test/bld/config_cache.xml
Looking for a valid GNU make... using gmake
Testing for Fortran 90 compatible compiler... using pgf95
Test linking to NetCDF library... ok
CAM configure done.
</PRE
></TD
></TR
></TABLE
><P
>&#13;The first line of output from the <B
CLASS="command"
>configure</B
> command is an echo of the
system command that <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> issues to invoke the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
<B
CLASS="command"
>configure</B
> utility.  <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>'s <B
CLASS="command"
>configure</B
> is responsible for setting the
values of the CPP macros that are needed to build the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> code.
</P
><P
>&#13;After the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> <B
CLASS="command"
>configure</B
> is complete the <ACRONYM
CLASS="acronym"
>MCT</ACRONYM
> <B
CLASS="command"
>configure</B
> script is
executed to create the Makefile for building <ACRONYM
CLASS="acronym"
>MCT</ACRONYM
> as a separate library.
There is a status line output to indicate success of that process.
</P
><P
>&#13;The next four lines of output inform the user of the files being created
by <B
CLASS="command"
>configure</B
>.  All these files except for the cache file are required to
be in the CAM build directory, so it is generally easiest to be in that
directory when <B
CLASS="command"
>configure</B
> is invoked.
</P
><P
>&#13;The output from the <KBD
CLASS="userinput"
>-test</KBD
> option tells us that
<B
CLASS="command"
>gmake</B
> is a GNU Make on this machine; that the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler
is <B
CLASS="command"
>pgf95</B
>; and that code compiled with the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
>
compiler can be successfully linked to the <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library.  The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
<B
CLASS="command"
>configure</B
> script is the place where the default compilers are specified.  On
<ACRONYM
CLASS="acronym"
>Linux</ACRONYM
> systems the default is <B
CLASS="command"
>pgf95</B
>.  Finally, since
this is a serial configuration no test for linking to the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> library was
done.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_fc"
>Specifying the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler</A
></H3
><P
>&#13;In the previous section the <B
CLASS="command"
>configure</B
> command was issued without
specifying which <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler to use.  For that to work we were
depending on the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> <B
CLASS="command"
>configure</B
> script to select a default compiler.  One of the
differences between the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone build and a build using the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
scripts is that <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> provides defaults
based on the operating system name (as determined by the <ACRONYM
CLASS="acronym"
>Perl</ACRONYM
> internal
variable <CODE
CLASS="envar"
>$OSNAME</CODE
>), while the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts require the user
to specify the machine (and compiler if the machine supports more than one)
as an argument to the <B
CLASS="command"
>create_newcase</B
> command.
</P
><P
>&#13;The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> makefile currently recognizes the following operating systems
and compilers.
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
>AIX</DT
><DD
><P
>&#13;xlf95_r, mpxlf95_r
</P
></DD
><DT
>Linux</DT
><DD
><P
>pgf95 (this is the default)</P
><P
>lf95</P
><P
>ifort</P
><P
>gfortran (has had minimal testing)</P
><P
>pathf90 (has had minimal testing)</P
></DD
><DT
>Darwin</DT
><DD
><P
>&#13;xlf95_r, mpxlf95_r, ifort
</P
></DD
><DT
>BGL</DT
><DD
><P
>&#13;blrts_xlf95
</P
></DD
><DT
>BGP</DT
><DD
><P
>&#13;mpixlf95_r
</P
></DD
></DL
></DIV
><P
>&#13;The above list contains two <ACRONYM
CLASS="acronym"
>IBM</ACRONYM
> Blue Gene machines; BGL and BGP.  The
executables on these machines are produced by cross compilation and hence
the configure script is not able to determine the machine for which the
build is intented.  In this case the user must supply this information to
<B
CLASS="command"
>configure</B
> by using the <KBD
CLASS="userinput"
>-target_os</KBD
> option with the
values of either <KBD
CLASS="userinput"
>bgl</KBD
> or <KBD
CLASS="userinput"
>bgp</KBD
>.
</P
><P
>&#13;On a <ACRONYM
CLASS="acronym"
>Linux</ACRONYM
> platform several compilers are recognized with the default
being <B
CLASS="command"
>pgf95</B
>.  It is assumed that the compiler to be used is in the user's
path (i.e., in one of the directories in the <CODE
CLASS="envar"
>PATH</CODE
> environment variable).
If it isn't then the <KBD
CLASS="userinput"
>-test</KBD
> option will issue an
error indicating that the compiler was not found.
</P
><P
>&#13;Suppose for example that one would like to use the <ACRONYM
CLASS="acronym"
>Intel</ACRONYM
> compiler on a
local <ACRONYM
CLASS="acronym"
>Linux</ACRONYM
> system.  The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> makefile recognizes <B
CLASS="command"
>ifort</B
> as the name
of the <ACRONYM
CLASS="acronym"
>Intel</ACRONYM
> compiler.  To invoke this compiler use
the <KBD
CLASS="userinput"
>-fc</KBD
> argument to <B
CLASS="command"
>configure</B
>.  The following
example illustrates the output you get when the compiler you ask for isn't
in your <CODE
CLASS="envar"
>PATH</CODE
>:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/configure -fc ifort -dyn fv -hgrid 10x15 -nospmd -nosmp -test 
Issuing command to the CICE configure utility:
  $CAM_ROOT/models/ice/cice/bld/configure -hgrid 10x15 -cice_mode prescribed \
  -ntr_aero 0 -ntasks 1 -nthreads 1 -cache config_cache_cice.xml \
  -cachedir /work/user/cam_test/bld
CICE configure done.
FAILURE: MCT configure
</PRE
></TD
></TR
></TABLE
><P
>&#13;In previous <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> versions this problem would be caught by
the <KBD
CLASS="userinput"
>-test</KBD
> option, but with the addition of <ACRONYM
CLASS="acronym"
>MCT</ACRONYM
>'s
<B
CLASS="command"
>configure</B
> the problem is now detected there.  By default <ACRONYM
CLASS="acronym"
>MCT</ACRONYM
> will be
build in a subdirectory of the build directory
named <TT
CLASS="filename"
>mct</TT
>.  That directory will contain a
file, <TT
CLASS="filename"
>config.log</TT
>, which should be examined to track
down the cause of the failure.  In this case the file contains the message:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;$CAM_ROOT/models/utils/mct/configure: line 3558: ifort: command not found
</PRE
></TD
></TR
></TABLE
><P
>&#13;This means that the <CODE
CLASS="envar"
>PATH</CODE
> environment variable has not been correctly set.
The first thing to try is to verify the directory that contains the
compiler, and then to prepend this directory name to the <CODE
CLASS="envar"
>PATH</CODE
> environment
variable.
</P
><P
>&#13;Another instance where the user needs to supply information about the
<ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler type to configure is when the compiler is being invoked
by a wrapper script.  A common example of this is using the <B
CLASS="command"
>mpif90</B
>
command to invoke the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler that was used to build the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
>
libraries.  This facilitates correct compilation and linking with the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
>
libraries without the user needing to add the required include and library
directories, or library names.  The same benefit is provided by the <B
CLASS="command"
>ftn</B
>
wrapper used on Cray XT and XE systems.  In the usual case that a <ACRONYM
CLASS="acronym"
>Linux</ACRONYM
>
OS is being used, since the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> makefile will not recognize these
compiler names, it will assume that the default compiler is being used, and
thus will supply compiler arguments that are appropriate for <B
CLASS="command"
>pgf90</B
>.  The
compilation will fail if <B
CLASS="command"
>pgf90</B
> is not the compiler being invoked by the
wrapper script (invoking <B
CLASS="command"
>configure</B
> with the <KBD
CLASS="userinput"
>-test</KBD
>
option is a good way to catch this problem).  The way to specify which
<ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler is being invoked by a wrapper script is via the
<KBD
CLASS="userinput"
>-fc_type</KBD
> argument to configure.  This argument takes
one of the values <KBD
CLASS="userinput"
>pgi</KBD
>, <KBD
CLASS="userinput"
>lahey</KBD
>,
<KBD
CLASS="userinput"
>intel</KBD
>, <KBD
CLASS="userinput"
>pathscale</KBD
>, <KBD
CLASS="userinput"
>gnu</KBD
>,
or <KBD
CLASS="userinput"
>xlf</KBD
>.
</P
><P
>&#13;<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> script attempts to determine the compiler type when a
compiler specific name is used.  It does so by a regular expression match
against the unique part of specific compiler names (e.g., any compiler name
matching 'pgf' will be given the default type of pgi).  If the default is
wrong then the user will need to manually override the default via setting
the <KBD
CLASS="userinput"
>-fc_type</KBD
> argument.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
We have made progress porting <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to the <B
CLASS="command"
>gfortran</B
>
compiler, but it is still not regularly tested or used for production work.
</P
></BLOCKQUOTE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_para"
>Configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for parallel execution</A
></H3
><P
>&#13;Before moving on to building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> we address configuring the executable for
parallel execution.  But before talking about configuration specifics let's
briefly discuss the parallel execution capabilities of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.
</P
><P
>&#13;<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> makes use of both distributed memory parallelism implemented using
<ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> (referred to throughout this document
as <A
HREF="http://en.wikipedia.org/wiki/SPMD"
TARGET="_top"
>SPMD</A
>), and shared
memory parallelism implemented using <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
> (referred to
as <A
HREF="http://en.wikipedia.org/wiki/Symmetric_multiprocessing"
TARGET="_top"
>SMP</A
>).
Each of these parallel modes may be used independently of the other, or
they may be used at the same time which we refer to as "hybrid mode".  When
talking about the SPMD mode we usually refer to the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> processes as
"tasks", and when talking about the SMP mode we usually refer to the <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
>
processes as "threads".  A feature of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> which is very helpful in code
development work is that the simulation results are independent of the
number of tasks and threads used.
</P
><P
>&#13;Now consider configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to run in pure SPMD mode.  Prior to the
introduction of <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> as the sea ice model
SPMD was turned on using the <KBD
CLASS="userinput"
>-spmd</KBD
> option.
But if we try that now we find the following:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/configure -dyn fv -hgrid 10x15 -spmd -nosmp
**    ERROR: If CICE decomposition parameters are not specified, then
**    -ntasks must be specified to determine a default decomposition
**    for a pure MPI run.  The setting was:  ntasks=
</PRE
></TD
></TR
></TABLE
><P
>&#13;A requirement of the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> model is that its grid decomposition (which is
independent of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s decomposition even when the two models are using the
same horizontal grid) must be specified at build time.  In order for
<ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>'s <B
CLASS="command"
>configure</B
> to set the decomposition it needs to know how much
parallelism is going to be used.  This information is provided by
specifying the number of <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> tasks that the job will use via setting
the <KBD
CLASS="userinput"
>-ntasks</KBD
> argument.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
> The default <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> decomposition can be overridden by
setting it explicitly using the <B
CLASS="command"
>configure</B
> options provided for that
purpose.
</P
></BLOCKQUOTE
></DIV
><P
>&#13;When running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> in <ACRONYM
CLASS="acronym"
>SPMD</ACRONYM
> mode the build procedure must be able to find
the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> include files and library.  The recommended method for doing this
is to use scripts provided by the <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> installation to invoke the compiler
and linker.  On <ACRONYM
CLASS="acronym"
>Linux</ACRONYM
> systems a common name for this script is <B
CLASS="command"
>mpif90</B
>.
The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> Makefile does not currently use this script by default on <ACRONYM
CLASS="acronym"
>Linux</ACRONYM
>
platforms, so the user must explicitly specify it on the <B
CLASS="command"
>configure</B
>
commandline using the <KBD
CLASS="userinput"
>-fc</KBD
> argument: 
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/configure -fc mpif90 -fc_type pgi -cc mpicc -dyn fv -hgrid 10x15 -ntasks 6 -nosmp -test
Issuing command to the CICE configure utility:
  $CAM_ROOT/models/ice/cice/bld/configure -hgrid 10x15 -cice_mode prescribed \
  -ntr_aero 0 -ntasks 6 -nthreads 1 -cache config_cache_cice.xml \
  -cachedir /work/user/cam_test/bld
CICE configure done.
MCT configure is done.
creating /work/user/cam_test/bld/Filepath
creating /work/user/cam_test/bld/Makefile
creating /work/user/cam_test/bld/config.h
creating /work/user/cam_test/bld/config_cache.xml
Looking for a valid GNU make... using gmake
Testing for Fortran 90 compatible compiler... using mpif90
Test linking to NetCDF library... ok
Test linking to MPI library... ok
CAM configure done.
</PRE
></TD
></TR
></TABLE
><P
>&#13;Notice that the number of tasks specified to <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> is passed
through to the commandline that invokes the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> <B
CLASS="command"
>configure</B
>.  Generally
any number of tasks that is appropriate for <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to use for a particular
horizontal grid will also work for <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>.  But it is possible to get an
error from <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> at this point in which case either the number of tasks
requested should be adjusted, or the options that set the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
decomposition explicitly will need to be used.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
The use of the <KBD
CLASS="userinput"
>-ntasks</KBD
> argument to <B
CLASS="command"
>configure</B
>
implies building for SPMD.  This means that an <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> library will be
required.  Hence, the specification <KBD
CLASS="userinput"
>-ntasks 1</KBD
> is not
the same as building for serial execution which is done via
the <KBD
CLASS="userinput"
>-nospmd</KBD
> option and does not require a full <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
>
library.  (Implementation detail: when building for serial mode a special
serial MPI library is used which basically provides a complete <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> API,
but doesn't do any message passing.)
</P
></BLOCKQUOTE
></DIV
><P
>&#13;Next consider configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to run in pure SMP mode.  Similarly to
<ACRONYM
CLASS="acronym"
>SPMD</ACRONYM
> mode, prior to the introduction of the sea ice component <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> the
<ACRONYM
CLASS="acronym"
>SMP</ACRONYM
> mode was turned on using the <KBD
CLASS="userinput"
>-smp</KBD
> option.  But
with <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>5 that will result in the same error from <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> that we obtained
above from attempting to use <KBD
CLASS="userinput"
>-spmd</KBD
>.  If we are going
to run the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> code in parallel, we need to specify up front how much
parallelism will be used so that the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> <B
CLASS="command"
>configure</B
> utility can set the
CPP macros that determine the grid decomposition.  We specify the amount of
SMP parallelism by setting the <KBD
CLASS="userinput"
>-nthreads</KBD
> option as
follows:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/configure -dyn fv -hgrid 10x15 -nospmd -nthreads 6 -test
Issuing command to the CICE configure utility:
  $CAM_ROOT/models/ice/cice/bld/configure -hgrid 10x15 -cice_mode prescribed \
  -ntr_aero 0 -ntasks 1 -nthreads 6 -cache config_cache_cice.xml \
  -cachedir /work/user/cam_test/bld
CICE configure done.
...
</PRE
></TD
></TR
></TABLE
><P
>&#13;We see that the number of threads has been passed through to the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
<B
CLASS="command"
>configure</B
> command.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
The use of the <KBD
CLASS="userinput"
>-nthreads</KBD
> argument to <B
CLASS="command"
>configure</B
>
implies building for SMP.  This means that the <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
> directives will be
compiled.  Hence, the specification <KBD
CLASS="userinput"
>-nthreads 1</KBD
> is
not the same as building for serial execution which is done via
the <KBD
CLASS="userinput"
>-nosmp</KBD
> option and does not require a compiler
that supports <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
>.
</P
></BLOCKQUOTE
></DIV
><P
>&#13;Finally, to configure <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for hybrid mode, simply specify both
the <KBD
CLASS="userinput"
>-ntasks</KBD
> and <KBD
CLASS="userinput"
>-nthreads</KBD
>
arguments to <B
CLASS="command"
>configure</B
>.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="build"
>Building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
></A
></H3
><P
>&#13;Once <B
CLASS="command"
>configure</B
> is successful, build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> by issuing the make
command:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% gmake -j2  &#62;&#38;! make.out
</PRE
></TD
></TR
></TABLE
><P
>&#13;The argument <KBD
CLASS="userinput"
>-j2</KBD
> is given to allow a parallel build
using 2 processes.  The optimal number of processes to use depends on the
compute resource available.  There is alot of available parallelism in the
build procedure, so using 16 or even 32 processes may speed things up
considerably.  Note however that the build happens in shared (not
distributed) memory.  So specifying more processes than there are
processors in a shared memory node is generally not helpful (although the
presence of hyperthreading or SMT on a node may allow specifying twice the
number of cores).
</P
><P
>&#13;It is useful to redirect the output from <B
CLASS="command"
>make</B
> to a file for later
reference.  This file contains the exact commands that were issued to
compile each file and the final command which links everything into an
executable file.  Relevant information from this file should be included
when posting a bug report concerning a build failure.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="bldnl_default"
>Building the Namelist</A
></H3
><P
>&#13;The first step in the run procedure is to generate the namelist files.  The
only safe way to generate consistent namelist settings is via the <B
CLASS="command"
>build-namelist</B
>
utility.  Even in the case where only a slight modification to the namelist
is desired, the best practice is to provide the modified value as an
argument to <B
CLASS="command"
>build-namelist</B
> and allow it to actually generate the namelist files.
</P
><P
>&#13;The following interactive C shell session builds a default namelist for
<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  We assume that a successful execution of <B
CLASS="command"
>configure</B
> was performed
in the build directory as discussed in the previous section.  This is an
essential prerequisite because the <TT
CLASS="filename"
>config_cache.xml</TT
>
file produced by <B
CLASS="command"
>configure</B
> is a required input file to <B
CLASS="command"
>build-namelist</B
>.  One of
the responsibilities of <B
CLASS="command"
>build-namelist</B
> is to set appropriate default values for
many namelist variables, and it can only do this if it knows how the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
executable was configured.  That information is present in the cache file.
As in the previous section
the shell variable <TT
CLASS="filename"
>camcfg</TT
> is set to the CAM configuration
directory ($<CODE
CLASS="envar"
>CAM_ROOT</CODE
>/models/atm/cam/bld).
</P
><P
>&#13;We begin by changing into the directory where <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> will be run.  It is
usually convenient to have the run directory be separate from the build
directory.  Possibly a number of different runs will be done that each need
to have a separate run directory for the output files, but will all use the
same executable file from a common build directory.  It is, of course,
possible to execute <B
CLASS="command"
>build-namelist</B
> in the build directory since that's where the
cache file is and so you don't need to specify to <B
CLASS="command"
>build-namelist</B
> where to find
that file (it looks in the current working directory by default).  But
then, assuming you plan to run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> in a different directory, all the
files produced by <B
CLASS="command"
>build-namelist</B
> need to be copied to the run directly.  If you're
running <B
CLASS="command"
>configure</B
> and <B
CLASS="command"
>build-namelist</B
> from a script, then you need to know how to
specify the filenames for the files that need to be copied.  For this
reason it's more robust to change to the run directory and execute <B
CLASS="command"
>build-namelist</B
>
there.  That way if there's a change to the files that are produced, your
script doesn't break due to the files not all getting copied to the run
directory.
</P
><P
>&#13;Next we set the <CODE
CLASS="envar"
>CSMDATA</CODE
> environment variable to point to the root
directory of the tree containing the input data files.  Note that this is
a required input for <B
CLASS="command"
>build-namelist</B
> (this information may alternatively be
provided using the <KBD
CLASS="userinput"
>-csmdata</KBD
> argument).  If not
provided then <B
CLASS="command"
>build-namelist</B
> will fail with an informative message.  The
information is required because many of the namelist variables have values
that are absolute filepaths.  These filepaths are resolved by <B
CLASS="command"
>build-namelist</B
> by
prepending the <CODE
CLASS="envar"
>CSMDATA</CODE
> root to the relative filepaths that are stored in
the default values database.
</P
><P
>&#13;The <B
CLASS="command"
>build-namelist</B
> commandline contains the <KBD
CLASS="userinput"
>-config</KBD
> argument
which is used to point to the cache file which was produced in the build
directory.  It also contains the <KBD
CLASS="userinput"
>-test</KBD
> argument,
explained further below.
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% cd /work/user/cam_test
% setenv CSMDATA /fs/cgd/csm/inputdata
% $camcfg/build-namelist -test -config /work/user/cam_test/bld/config_cache.xml
Writing CICE namelist to ./ice_in 
Writing RTM namelist to ./rof_in 
Writing DOCN namelist to ./docn_ocn_in 
Writing DOCN stream file to ./docn.stream.txt 
Writing CLM namelist to ./lnd_in 
Writing driver namelist to ./drv_in 
CAM writing dry deposition namelist to drv_flds_in 
Writing ocean component namelist to ./docn_in 
CAM writing namelist to atm_in 
Checking whether input datasets exist locally...
OK -- found depvel_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/dvel/depvel_monthly.nc
OK -- found tracer_cnst_filelist = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/oxid/oxid_1.9x2.5_L26_clim_list.c090805.txt
OK -- found tracer_cnst_datapath = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/oxid
OK -- found depvel_lnd_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/dvel/regrid_vegetation.nc
OK -- found xs_long_file = /fs/cgd/csm/inputdata/atm/waccm/phot/temp_prs_GT200nm_jpl06_c080930.nc
OK -- found rsf_file = /fs/cgd/csm/inputdata/atm/waccm/phot/RSF_GT200nm_v3.0_c080416.nc
OK -- found clim_soilw_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/dvel/clim_soilw.nc
OK -- found exo_coldens_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/phot/exo_coldens.nc
OK -- found tracer_cnst_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/oxid/oxid_1.9x2.5_L26_1850-2005_c091123.nc
OK -- found season_wes_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/dvel/season_wes.nc
OK -- found solar_data_file = /fs/cgd/csm/inputdata/atm/cam/solar/solar_ave_sc19-sc23.c090810.nc
OK -- found soil_erod = /fs/cgd/csm/inputdata/atm/cam/dst/dst_10x15_c090203.nc
OK -- found bndtvs = /fs/cgd/csm/inputdata/atm/cam/sst/sst_HadOIBl_bc_10x15_clim_c050526.nc
OK -- found focndomain = /fs/cgd/csm/inputdata/atm/cam/ocnfrac/domain.camocn.10x15_USGS_070807.nc
OK -- found tropopause_climo_file = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart/ub/clim_p_trop.nc
OK -- found fpftcon = /fs/cgd/csm/inputdata/lnd/clm2/pftdata/pft-physiology.c110425.nc
OK -- found fsnowaging = /fs/cgd/csm/inputdata/lnd/clm2/snicardata/snicar_drdt_bst_fit_60_c070416.nc
OK -- found fatmlndfrc = /fs/cgd/csm/inputdata/share/domains/domain.lnd.fv10x15_USGS.110713.nc
OK -- found fsnowoptics = /fs/cgd/csm/inputdata/lnd/clm2/snicardata/snicar_optics_5bnd_c090915.nc
OK -- found fsurdat = /fs/cgd/csm/inputdata/lnd/clm2/surfdata/surfdata_10x15_simyr2000_c090928.nc
OK -- found prescribed_ozone_datapath = /fs/cgd/csm/inputdata/atm/cam/ozone
OK -- found prescribed_ozone_file = /fs/cgd/csm/inputdata/atm/cam/ozone/ozone_1.9x2.5_L26_2000clim_c091112.nc
OK -- found liqopticsfile = /fs/cgd/csm/inputdata/atm/cam/physprops/F_nwvl200_mu20_lam50_res64_t298_c080428.nc
OK -- found iceopticsfile = /fs/cgd/csm/inputdata/atm/cam/physprops/iceoptics_c080917.nc
OK -- found water_refindex_file = /fs/cgd/csm/inputdata/atm/cam/physprops/water_refindex_rrtmg_c080910.nc
OK -- found ncdata = /fs/cgd/csm/inputdata/atm/cam/inic/fv/cami_0000-01-01_10x15_L30_c081013.nc
OK -- found bnd_topo = /fs/cgd/csm/inputdata/atm/cam/topo/USGS-gtopo30_10x15_remap_c050520.nc
OK -- found ext_frc_specifier for SO2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so2_elev_2000_c090726.nc
OK -- found ext_frc_specifier for bc_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_bc_elev_2000_c090726.nc
OK -- found ext_frc_specifier for num_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a1_elev_2000_c090726.nc
OK -- found ext_frc_specifier for num_a2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a2_elev_2000_c090726.nc
OK -- found ext_frc_specifier for pom_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_oc_elev_2000_c090726.nc
OK -- found ext_frc_specifier for so4_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a1_elev_2000_c090726.nc
OK -- found ext_frc_specifier for so4_a2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a2_elev_2000_c090726.nc
OK -- found srf_emis_specifier for DMS = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/aerocom_mam3_dms_surf_2000_c090129.nc
OK -- found srf_emis_specifier for SO2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so2_surf_2000_c090726.nc
OK -- found srf_emis_specifier for SOAG = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_soag_1.5_surf_2000_c100217.nc
OK -- found srf_emis_specifier for bc_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_bc_surf_2000_c090726.nc
OK -- found srf_emis_specifier for num_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a1_surf_2000_c090726.nc
OK -- found srf_emis_specifier for num_a2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a2_surf_2000_c090726.nc
OK -- found srf_emis_specifier for pom_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_oc_surf_2000_c090726.nc
OK -- found srf_emis_specifier for so4_a1 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a1_surf_2000_c090726.nc
OK -- found srf_emis_specifier for so4_a2 = /fs/cgd/csm/inputdata/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a2_surf_2000_c090726.nc
OK -- found mode_defs for so4_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc
OK -- found mode_defs for pom_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/ocpho_rrtmg_c101112.nc
OK -- found mode_defs for soa_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc
OK -- found mode_defs for bc_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/bcpho_rrtmg_c100508.nc
OK -- found mode_defs for dst_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/dust4_rrtmg_c090521.nc
OK -- found mode_defs for ncl_a1 = /fs/cgd/csm/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc
OK -- found mode_defs for so4_a2 = /fs/cgd/csm/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc
OK -- found mode_defs for soa_a2 = /fs/cgd/csm/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc
OK -- found mode_defs for ncl_a2 = /fs/cgd/csm/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc
OK -- found mode_defs for dst_a3 = /fs/cgd/csm/inputdata/atm/cam/physprops/dust4_rrtmg_c090521.nc
OK -- found mode_defs for ncl_a3 = /fs/cgd/csm/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc
OK -- found mode_defs for so4_a3 = /fs/cgd/csm/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc
OK -- found rad_climate for mam3_mode1 = /fs/cgd/csm/inputdata/atm/cam/physprops/mam3_mode1_rrtmg_c110318.nc
OK -- found rad_climate for mam3_mode2 = /fs/cgd/csm/inputdata/atm/cam/physprops/mam3_mode2_rrtmg_c110318.nc
OK -- found rad_climate for mam3_mode3 = /fs/cgd/csm/inputdata/atm/cam/physprops/mam3_mode3_rrtmg_c110318.nc
</PRE
></TD
></TR
></TABLE
><P
>&#13;The first nine lines of output from <B
CLASS="command"
>build-namelist</B
> inform the user of the files
that have been created.  There are namelist files for the ice component
(<TT
CLASS="filename"
>ice_in</TT
>), the river runoff component
(<TT
CLASS="filename"
>rof_in</TT
>), the land component
(<TT
CLASS="filename"
>lnd_in</TT
>), the data ocean component
(<TT
CLASS="filename"
>docn_in</TT
>, <TT
CLASS="filename"
>docn_ocn_in</TT
>), the
atmosphere component (<TT
CLASS="filename"
>atm_in</TT
>), the driver
(<TT
CLASS="filename"
>drv_in</TT
>), and a file that is read by both the
atmosphere and land components (<TT
CLASS="filename"
>drv_flds_in</TT
>).  There
is also a "stream file" (<TT
CLASS="filename"
>docn.stream.txt</TT
>) which is
read by the data ocean component.  Note that these filenames are hardcoded
in the components and my not be changed without source code modifications.
</P
><P
>&#13;The next section of output is the result of using
the <KBD
CLASS="userinput"
>-test</KBD
> argument to <B
CLASS="command"
>build-namelist</B
>.  As with <B
CLASS="command"
>configure</B
>
we recommend using this argument whenever a model configuration is being
run for the first time.  It checks that each of the files that are present
in the generated namelists can be found in the input data tree whose root
is given by the <CODE
CLASS="envar"
>CSMDATA</CODE
> environment variable.  If a file is not found
then the user will need to take steps to make that file accessible to the
executing model before a successful run will be possible.  The following is
a list of possible actions:

<P
></P
><OL
TYPE="1"
><LI
><P
>Acquire the missing file.  If this is a default file
    supplied by the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> project then you will be able to download the
    file from the project's svn data repository (see 
    <A
HREF="#acquire_inputdata"
>the Section called <I
>Acquiring Input Datasets</I
></A
>). </P
></LI
><LI
><P
>If you have write permissions in the directory under
    $<CODE
CLASS="envar"
>CSMDATA</CODE
> then add the missing file to the appropriate
    location there.
</P
></LI
><LI
><P
>If you don't have write permissions under $<CODE
CLASS="envar"
>CSMDATA</CODE
> then
    put the file in a place where you can (for example, your run directory)
    and rerun <B
CLASS="command"
>build-namelist</B
> with an explicit setting for the file using your
    specific filepath.</P
></LI
></OL
>

</P
><P
>&#13;Expanding a bit on rerunning <B
CLASS="command"
>build-namelist</B
>: let's say for example that the 
<KBD
CLASS="userinput"
>-test</KBD
> option informed you that the
<KBD
CLASS="userinput"
>ncdata</KBD
>
file <TT
CLASS="filename"
>cami_0000-01-01_10x15_L30_c081013.nc</TT
> was not
found.  You acquire the file from the data repository, but don't have
permissions to write in the $<CODE
CLASS="envar"
>CSMDATA</CODE
> tree.  So you put the file in your
run directory and issue a <B
CLASS="command"
>build-namelist</B
> command that looks like this:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% $camcfg/build-namelist -config /work/user/cam_test/bld/config_cache.xml \
  -namelist "&#38;atm ncdata='/work/user/cam_test/cami_0000-01-01_10x15_L30_c081013.nc' /"
</PRE
></TD
></TR
></TABLE
><P
>&#13;Now the namelist in <TT
CLASS="filename"
>atm_in</TT
> will contain an initial
file (specified by namelist variable <KBD
CLASS="userinput"
>ncdata</KBD
>) which
will be found by the executing <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> model.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
This particular configuration of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> which is using the
default <KBD
CLASS="userinput"
>cam5</KBD
> physics package requires that about 60
datasets be specified in order to run correctly.  Trying to manage
namelists of that complexity by hand editing files is extremely error prone
and is strongly discouraged.  User modifications to the default namelist
settings can be made in a number of ways while still letting
<B
CLASS="command"
>build-namelist</B
> actually generate the final namelist.  In particular, the 
<KBD
CLASS="userinput"
>-namelist</KBD
>, <KBD
CLASS="userinput"
>-infile</KBD
>,
and <KBD
CLASS="userinput"
>-use_case</KBD
> arguments to <B
CLASS="command"
>build-namelist</B
> are all
mechanisms by which the user can override default values or specify
additional namelist variables and still allow build-namelist to do the
error and consistency checking which makes the namelist creation process
more robust.
</P
></BLOCKQUOTE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="acquire_inputdata"
>Acquiring Input Datasets</A
></H3
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
If you are doing a standard production run that is supported in the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
scripts, then using those scripts will automatically invoke a utility to
acquire needed input datasets.  The information in this section is to aid
developers using <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone scripts.
</P
></BLOCKQUOTE
></DIV
><P
>&#13;The input datasets required to run <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> are available from a Subversion
repository located here:
<A
HREF="https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata/"
TARGET="_top"
>https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata/</A
>.
The user name and password for the input data repository will be the same
as for the code repository (which are provided to users when they register
to acquire access to the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> source code repository).
</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="acquire_inputdata_ex01"
>Example</A
></H4
><P
>&#13;If you have a list of files that you need to acquire before running
<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>, then you can either just issue commands interactively, or if your
list is rather long then you may want to put the commands into a shell
script.  For example, 
suppose after running <B
CLASS="command"
>build-namelist</B
> with the <KBD
CLASS="userinput"
>-test</KBD
> option
you find that you need to acquire the file
<TT
CLASS="filename"
>/fs/cgd/csm/inputdata/atm/cam/inic/fv/cami_0000-01-01_10x15_L26_c030918.nc</TT
>.
And let's assume that <TT
CLASS="filename"
>/fs/cgd/csm/inputdata/</TT
> is the
root directory of the inputdata tree, and that you have permissions to
write there.  If the subdirectory <TT
CLASS="filename"
>atm/cam/inic/fv/</TT
>
doesn't already exist, then create it.  Finally, issue the following
commands at an interactive C shell prompt:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% set svnrepo='https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata'
% cd /fs/cgd/csm/inputdata/atm/cam/inic/fv
% svn export $svnrepo/atm/cam/inic/fv/cami_0000-01-01_10x15_L26_c030918.nc
Error validating server certificate for 'https://svn-ccsm-inputdata.cgd.ucar.edu:443':
 - The certificate is not issued by a trusted authority. Use the
   fingerprint to validate the certificate manually!
 - The certificate hostname does not match.
 - The certificate has expired.
Certificate information:
 - Hostname: localhost.localdomain
 - Valid: from Feb 20 23:32:25 2008 GMT until Feb 19 23:32:25 2009 GMT
 - Issuer: SomeOrganizationalUnit, SomeOrganization, SomeCity, SomeState, --
 - Fingerprint: 86:01:bb:a4:4a:e8:4d:8b:e1:f1:01:dc:60:b9:96:22:67:a4:49:ff
(R)eject, accept (t)emporarily or accept (p)ermanently? p
A    cami_0000-01-01_10x15_L26_c030918.nc
Export complete.
</PRE
></TD
></TR
></TABLE
><P
>&#13;The messages about validating the server certificate will only occur for
the first file that you export if you answer "p" to the question as in the
example above.
</P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="run_cam"
>Running CAM</A
></H3
><P
>&#13;Once the namelist files have successfully been produced, and the necessary
input datasets are available, the model is ready to run.  Usually <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
will be run with SPMD parallelization enabled, and this requires setting up
MPI resources and possibly dealing with batch queues.  These issues will be
addressed briefly in <A
HREF="#run_scripts"
>the Section called <I
>Sample Run Scripts</I
></A
>.  But for a simple test
in serial mode executed from an interactive shell, we only need to issue
the following command:
</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13;% /work/user/cam_test/bld/cam &#62;&#38;! cam.log
</PRE
></TD
></TR
></TABLE
><P
>&#13;The commandline above redirects STDOUT and STDERR to the
file <TT
CLASS="filename"
>cam.log</TT
>.  The <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> logfile contains a
substantial amount of information from all components that can be used to
verify that the model is running as expected.  Things like namelist variable
settings, input datasets used, and output datasets created are all echoed
to the log file.  This is the first place to look for problems when a model
run is unsuccessful.  It is also very useful to include relevant
information from the logfile when submitting bug reports.
</P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="run_scripts"
>Sample Run Scripts</A
></H2
><P
>&#13;</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="examples"
>Examples</A
></H2
><P
>&#13;This section provides a few examples of using <B
CLASS="command"
>configure</B
> and <B
CLASS="command"
>build-namelist</B
> to
set up a variety of model runs.
</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="ccsm"
>Running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> via the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts</A
></H2
><P
>&#13;See
<A
HREF="../../../../cesm1.1/cesm/doc/usersguide/book1.html"
TARGET="_top"
>&#13;<ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>-1.1 User's Guide</A
>.
</P
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="model_out"
></A
>Chapter 3. Model Output</H1
><P
>&#13;<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> produces a series of <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> format history files containing
atmospheric gridpoint data generated during the course of a run. It
also produces a series of <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> format restart files necessary to continue a
run once it has terminated successfully and a series of initial
conditions files that may be used to initialize new simulations. The
contents of these datasets are described below.  
</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="hist_files"
>Model History Files</A
></H2
><P
>&#13;History files contain model data values written at specified frequencies
during a run.  Options are also available to record averaged,
instantaneous, maximum, or minimum values on a field-by-field basis.  If
the user wishes to see a field written at more than one time frequency
(e.g. daily, hourly), additional history files must be declared.  This
functionality is available via setting namelist variables.
</P
><P
>&#13;History files may be visualized using various commercial or freely
available tools. Examples include the the NCAR Graphics package (via NCL),
FERRET, ncview, MATLAB, AVS, IDL, and Yorick. For a list of software tools
for interacting with NetCDF files, view the link
<A
HREF="http://www.unidata.ucar.edu/software/netcdf/software.html"
TARGET="_top"
>&#13;Software for Manipulating or Displaying NetCDF Data</A
>.
</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="hist_fields"
>Fields Output to History Files</A
></H3
><P
>&#13;<ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is set up by default to output a set of fields to a single monthly
average history file.  There is a much larger set of available fields,
known as the "master field list," from which the user can choose fields of
interest to add to the history file via namelist settings.  Both the set of
default fields and the master field list depend on how <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is configured.
Due to the large number of fields we have chosen to make lists of fields
for some standard configuration available via linked documents rather than
to inline the lists here.  Each of the field list documents is comprised of
tables containing the lists of fields that are output by default as well as
the master field list.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
The master field list tables may contain some fields that are not actually
available for output.  The presence of a field in the master field list is
a necessary, but not sufficient condition that the corresponding field in
the history file will contain valid data.  This is because in some
instances fields are added to the master field list (this is done in the
source code) even though that field may not be computed in the
configuration that is built (specified via the arguments to <B
CLASS="command"
>configure</B
>).
When adding non-default fields to the history file it's important to check
that the fields contain reasonable data before doing a long run.
</P
></BLOCKQUOTE
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="hist_fld_lists"
>Default History Fields and Master Field Lists</A
></H4
><P
>&#13;
The following links provide tables of default and master field lists for
some standard model configurations which are characterized by the values of
the <CODE
CLASS="option"
>-dyn</CODE
>, <CODE
CLASS="option"
>-phys</CODE
>,
and <CODE
CLASS="option"
>-chem</CODE
> arguments to <B
CLASS="command"
>configure</B
>.

<P
></P
><UL
><LI
><P
>&#13;    <A
HREF="../../../../cesm1.1/cam/docs/ug5_2/hist_flds_fv_cam4.html"
TARGET="_top"
>&#13;    fv, cam4, none</A
>
</P
></LI
><LI
><P
>&#13;    <A
HREF="../../../../cesm1.1/cam/docs/ug5_2/hist_flds_fv_cam4_trop_bam.html"
TARGET="_top"
>&#13;    fv, cam4, trop_bam</A
>
</P
></LI
><LI
><P
>&#13;    <A
HREF="../../../../cesm1.1/cam/docs/ug5_2/hist_flds_fv_cam5.html"
TARGET="_top"
>&#13;    fv, cam5, trop_mam3</A
>
</P
></LI
><LI
><P
>&#13;    <A
HREF="../../../../cesm1.1/cam/docs/ug5_2/hist_flds_fv_cam4_waccm.html"
TARGET="_top"
>&#13;    fv, cam4, waccm_mozart</A
> (use_case: waccm_2000_cam4)
</P
></LI
><LI
><P
>&#13;    <A
HREF="../../../../cesm1.1/cam/docs/ug5_2/hist_flds_fv_cam4_super_fast_llnl.html"
TARGET="_top"
>&#13;    fv, cam4, super_fast_llnl</A
> (use_case: 2000_cam4_super_fast_llnl)
</P
></LI
></UL
>
</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="config"
></A
>Appendix A. The <B
CLASS="command"
>configure</B
> utility</H1
><P
>&#13;The <B
CLASS="command"
>configure</B
> utility provides a flexible way to specify any
configuration of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  The best way to communicate to another user how
you built <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is to simply supply them with the <B
CLASS="command"
>configure</B
> commandline
that was used (along with the source code version).
</P
><P
>&#13;<B
CLASS="command"
>configure</B
> has two distinct operating modes which correspond to the two distinct
ways of building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>, i.e., either using the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts, or using <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>
standalone scripts.  By default <B
CLASS="command"
>configure</B
> runs in the mode used by the
standalone scripts.  In this mode <B
CLASS="command"
>configure</B
> is responsible for setting
the filepaths and CPP macros needed to build not only <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>, but all the
components of the standalone configuration including the land, sea ice,
data ocean, and driver.  In the mode used when building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
scripts <B
CLASS="command"
>configure</B
> is only responsible for setting the filepaths and CPP
macros needed to build a library containing just the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> component.
</P
><P
>&#13;When configuring a build of standalone <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>, <B
CLASS="command"
>configure</B
> produces the files
<TT
CLASS="filename"
>Filepath</TT
> and <TT
CLASS="filename"
>Makefile</TT
>.  In addition, a configuration cache file
(<TT
CLASS="filename"
>config_cache.xml</TT
> by default) is written which contains the values of all the
configuration parameters set by <B
CLASS="command"
>configure</B
>.  The files produced by
<B
CLASS="command"
>configure</B
> are written to the directory where <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> will be built, which
by default is the directory from which <B
CLASS="command"
>configure</B
> is executed, but can be
specified to be elsewhere (see
the <A
HREF="#cam_bld"
><CODE
CLASS="option"
>-cam_bld</CODE
></A
> option).
</P
><P
>&#13;When configuring <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> for a build using the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts,
<B
CLASS="command"
>configure</B
> doesn't write a Makefile, but instead writes a file
<TT
CLASS="filename"
>CCSM_cppdefs</TT
> which is used by the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> Makefile.
Also, the <TT
CLASS="filename"
>Filepath</TT
> file only contains paths for the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> component.
</P
><P
>&#13;In both modes <B
CLASS="command"
>configure</B
> is responsible for setting the correct filepaths
and CPP macros to produce the desired configuration of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s dynamical
core, physics parameterizations and chemistry scheme.  The options
that are involved in making these choices are described in
<A
HREF="#config_cam"
>the Section called <I
>CAM configuration</I
></A
> below.  The subsequent sections describe
options used by the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone scripts.
</P
><P
>&#13;<B
CLASS="command"
>configure</B
> will optionally perform tests to validate that the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
>
compiler is operational and <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> 90 compliant, and that the linker can
resolve references to required external libraries (<ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> and possibly
<ACRONYM
CLASS="acronym"
>MPI</ACRONYM
>).  These tests will point out problems with the user environment in a
way that is much easier to understand than looking at the output from a
failed build of <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  We strongly recommend that the first time <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is
built on any new machine, <B
CLASS="command"
>configure</B
> should be invoked to execute these
tests (see the <A
HREF="#cfg_test"
><CODE
CLASS="option"
>-test</CODE
></A
> option).
</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="config_cesm"
>How <B
CLASS="command"
>configure</B
> is called from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts</A
></H2
><P
>&#13;The <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts access <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> via the script 
<TT
CLASS="filename"
>$CAM_ROOT/models/atm/cam/bld/cam.buildnml.csh</TT
>.  The
<TT
CLASS="filename"
>cam.buildnml.csh</TT
> script acts as the interface between
the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts and <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>'s <B
CLASS="command"
>configure</B
> and <B
CLASS="command"
>build-namelist</B
> utilities.
</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="config_opts"
>Options to <B
CLASS="command"
>configure</B
></A
></H2
><P
>&#13;All configuration options can be specified using command line arguments to
<B
CLASS="command"
>configure</B
> and this is the recommended practice.  Options specified via
command line arguments take precedence over options specified any other way.
</P
><P
>&#13;At the next level of precedence a few options can be specified by setting
environment variables.  And finally, at the lowest precedence, many options
have hard-coded defaults.  Most of these are located in the files
<TT
CLASS="filename"
>$CAM_ROOT/models/atm/cam/bld/config_files/defaults_*.xml</TT
>.
A few that depend on the values of other options are set by logic
contained in the <B
CLASS="command"
>configure</B
> script (a <ACRONYM
CLASS="acronym"
>Perl</ACRONYM
> script). The hard-coded defaults
are designed to produce the standard production configurations of CAM.
</P
><P
>&#13;The configure script allows the user to specify compile time options such as 
model resolution, dynamical core type, additional compiler flags, and many other 
aspects. The user can type <KBD
CLASS="userinput"
>configure --help</KBD
> for a complete
list of available options.
</P
><P
>&#13;The options may all be specified with either one or two leading
dashes, e.g., <CODE
CLASS="option"
>-help</CODE
> or <CODE
CLASS="option"
>--help</CODE
>.  The few
options that can be expressed as single letter switches may not be clumped,
e.g., <CODE
CLASS="option"
>-h -s -v</CODE
> may <I
CLASS="emphasis"
>NOT</I
> be expressed
as <CODE
CLASS="option"
>-hsv</CODE
>.  When multiple options are listed separated by a
vertical bar either version may be used.
</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_cam"
>CAM configuration</A
></H3
><P
>&#13;<I
CLASS="emphasis"
>These options will have an effect whether running <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> as part of <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> or
running in a <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> standalone mode:</I
>
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-[no]age_of_air_trcs</CODE
></DT
><DD
><P
>&#13;Switch on [off] age of air tracers. Default: on for waccm_phys, otherwise off.
</P
></DD
><DT
><A
NAME="carma"
></A
><CODE
CLASS="option"
>-carma</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> with specified CARMA microphysics model
[ <CODE
CLASS="constant"
>none</CODE
> | <CODE
CLASS="constant"
>bc_strat</CODE
> | <CODE
CLASS="constant"
>cirrus</CODE
> |
  <CODE
CLASS="constant"
>dust</CODE
> | <CODE
CLASS="constant"
>meteor_smoke</CODE
> | <CODE
CLASS="constant"
>pmc</CODE
> |
  <CODE
CLASS="constant"
>sea_salt</CODE
> | <CODE
CLASS="constant"
>sulfate</CODE
> | <CODE
CLASS="constant"
>test_detrain</CODE
> |
  <CODE
CLASS="constant"
>test_growth</CODE
> | <CODE
CLASS="constant"
>test_passive</CODE
> |
  <CODE
CLASS="constant"
>test_radiative</CODE
> | <CODE
CLASS="constant"
>test_swelling</CODE
> |
  <CODE
CLASS="constant"
>test_tracers</CODE
> ].
Default: <CODE
CLASS="constant"
>none</CODE
>.
</P
></DD
><DT
><A
NAME="chem"
></A
><CODE
CLASS="option"
>-chem</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> with specified prognostic chemistry package 
[ <CODE
CLASS="constant"
>waccm_mozart</CODE
> | <CODE
CLASS="constant"
>waccm_mozart_v1</CODE
> |
  <CODE
CLASS="constant"
>waccm_mozart_sulfur</CODE
> |
  <CODE
CLASS="constant"
>waccm_ghg</CODE
> | <CODE
CLASS="constant"
>trop_mozart</CODE
> |
  <CODE
CLASS="constant"
>trop_mozart_mam3</CODE
> |
  <CODE
CLASS="constant"
>trop_mozart_soa</CODE
> | <CODE
CLASS="constant"
>trop_ghg</CODE
> |
  <CODE
CLASS="constant"
>trop_bam</CODE
> | <CODE
CLASS="constant"
>trop_mam3</CODE
> |
  <CODE
CLASS="constant"
>trop_mam7</CODE
> | <CODE
CLASS="constant"
>super_fast_llnl</CODE
> |
  <CODE
CLASS="constant"
>super_fast_llnl_mam3</CODE
> | <CODE
CLASS="constant"
>trop_strat_bam_v1</CODE
> |
  <CODE
CLASS="constant"
>trop_strat_mam3</CODE
> | <CODE
CLASS="constant"
>trop_strat_mam7</CODE
> |
  <CODE
CLASS="constant"
>none</CODE
> ].
Default: <CODE
CLASS="constant"
>trop_mam3</CODE
> if the physics package
  is <CODE
CLASS="constant"
>cam5</CODE
>, otherwise default is <CODE
CLASS="constant"
>none</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-clubb_sgs</CODE
></DT
><DD
><P
>&#13;Switch to turn on the CLUBB_SGS package.
Default: Off.
</P
></DD
><DT
><CODE
CLASS="option"
>-co2_cycle</CODE
></DT
><DD
><P
>&#13;This option is usually used with the <CODE
CLASS="option"
>-ccsm_seq</CODE
> option as
part of the configuration for running biogeochemistry (BGC) compsets.
It modifies the CAM configuration by increasing the number of advected
constituents by 4. 
Default: not set.
</P
></DD
><DT
><CODE
CLASS="option"
>-comp_intf</CODE
> [<CODE
CLASS="constant"
>mct</CODE
>
 | <CODE
CLASS="constant"
>esmf</CODE
>]</DT
><DD
><P
>&#13;Specify the component interfaces
Default: <CODE
CLASS="constant"
>mct</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-cosp</CODE
></DT
><DD
><P
>&#13;Enable the COSP simulator package.
Default: not set.
</P
></DD
><DT
><CODE
CLASS="option"
>-cppdefs</CODE
> <KBD
CLASS="userinput"
>&#60;string&#62;</KBD
></DT
><DD
><P
>&#13;A string of user specified CPP defines appended to
Makefile defaults.  E.g. <CODE
CLASS="option"
>-cppdefs</CODE
> <CODE
CLASS="constant"
>'-DVAR1
    -DVAR2'</CODE
>.  Note that a string containing whitespace will need
to be quoted.
</P
></DD
><DT
><CODE
CLASS="option"
>-dyn</CODE
> [<CODE
CLASS="constant"
>eul</CODE
> |
 <CODE
CLASS="constant"
>sld</CODE
> | <CODE
CLASS="constant"
>fv</CODE
>
 | <CODE
CLASS="constant"
>homme</CODE
> ]</DT
><DD
><P
>&#13;Build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> with specified dynamical core.  Note that the spectral element
dycore is specified by using the option <CODE
CLASS="constant"
>homme</CODE
>.
Default: <CODE
CLASS="constant"
>fv</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-edit_chem_mech</CODE
></DT
><DD
><P
>&#13;Invokes <CODE
CLASS="envar"
>CAMCHEM_EDITOR</CODE
> to allow the user to edit the chemistry mechanism file.
</P
></DD
><DT
><CODE
CLASS="option"
>-hgrid</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Specify horizontal grid.  For spectral grids
use <CODE
CLASS="constant"
>nlat</CODE
>x<CODE
CLASS="constant"
>nlon</CODE
>
where <CODE
CLASS="constant"
>nlat</CODE
> and <CODE
CLASS="constant"
>nlon</CODE
> are the
number of latitude and longitude grid points respectively in the global Gaussian
grid.  For FV grids use <CODE
CLASS="constant"
>dlat</CODE
>x<CODE
CLASS="constant"
>dlon</CODE
>
where <CODE
CLASS="constant"
>dlat</CODE
> and <CODE
CLASS="constant"
>dlon</CODE
> are the grid
cell size in degrees for latitude and longitude respectively.  For SE grids
(cubed sphere) use <CODE
CLASS="constant"
>ne</CODE
>x<CODE
CLASS="constant"
>np</CODE
>
where <CODE
CLASS="constant"
>ne</CODE
> is the number of elements on an edge of the
cube, and <CODE
CLASS="constant"
>np</CODE
> is the number of Gauss points on the edge
of an element.
</P
></DD
><DT
><CODE
CLASS="option"
>-microphys</CODE
> [<CODE
CLASS="constant"
>mg</CODE
> | <CODE
CLASS="constant"
>rk</CODE
>]</DT
><DD
><P
>&#13;Microphysics package.
Default: <CODE
CLASS="constant"
>mg</CODE
> if the physics package
is <CODE
CLASS="constant"
>cam5</CODE
>, otherwise <CODE
CLASS="constant"
>rk</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-nadv</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Set total number of advected species to <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
>.  If <CODE
CLASS="option"
>-nadv</CODE
>
is set to a larger number than is required by the selected physics and
chemistry schemes, then the remainder will automatically be used for test
tracers.  Default: set to the number required by the
selected physics and chemistry schemes.
</P
></DD
><DT
><CODE
CLASS="option"
>-nadv_tt</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Set number of advected test tracers to <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
>.  Default: 0.
</P
></DD
><DT
><CODE
CLASS="option"
>-nlev</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Set number of vertical layers to <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
>.
Default: <CODE
CLASS="constant"
>30</CODE
> if the physics package
is <CODE
CLASS="constant"
>cam5</CODE
>, <CODE
CLASS="constant"
>ideal</CODE
>,
or <CODE
CLASS="constant"
>adiabatic</CODE
>.  <CODE
CLASS="constant"
>26</CODE
> if the physics package
is <CODE
CLASS="constant"
>cam4</CODE
>.  <CODE
CLASS="constant"
>66</CODE
> if the chemistry package
is <CODE
CLASS="constant"
>waccm_*</CODE
>.  <CODE
CLASS="constant"
>81</CODE
> if
the <CODE
CLASS="option"
>-waccmx</CODE
> is used.
</P
></DD
><DT
><CODE
CLASS="option"
>-offline_dyn</CODE
></DT
><DD
><P
>&#13;Switch enables the use of offline driver for FV dycore.
Default: not set.
</P
></DD
><DT
><CODE
CLASS="option"
>-pbl</CODE
> [<CODE
CLASS="constant"
>uw</CODE
>
    | <CODE
CLASS="constant"
>hb</CODE
> | <CODE
CLASS="constant"
>hbr</CODE
> | <CODE
CLASS="constant"
>clubb_sgs</CODE
>]</DT
><DD
><P
>&#13;PBL package.
Default: <CODE
CLASS="constant"
>uw</CODE
> if the physics package
is <CODE
CLASS="constant"
>cam5</CODE
>; <CODE
CLASS="constant"
>clubb_sgs</CODE
> if the <CODE
CLASS="option"
>-clubb_sgs</CODE
>
switch is set; otherwise <CODE
CLASS="constant"
>hb</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-pcols</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Set maximum number of columns in a chunk to <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
>.  Default: 16.
</P
></DD
><DT
><CODE
CLASS="option"
>-pergro</CODE
></DT
><DD
><P
>&#13;Switch enables building CAM for perturbation growth tests.  Only valid with
<CODE
CLASS="constant"
>cam3</CODE
> and <CODE
CLASS="constant"
>cam4</CODE
> physics packages.
</P
></DD
><DT
><CODE
CLASS="option"
>-phys</CODE
> [<CODE
CLASS="constant"
>cam3</CODE
> |
 <CODE
CLASS="constant"
>cam4</CODE
> | <CODE
CLASS="constant"
>cam5</CODE
> | 
 <CODE
CLASS="constant"
>ideal</CODE
> | <CODE
CLASS="constant"
>adiabatic</CODE
>]</DT
><DD
><P
>&#13;Physics package. Default: <CODE
CLASS="constant"
>cam5</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-prog_species</CODE
> <KBD
CLASS="userinput"
>&#60;list&#62;</KBD
></DT
><DD
><P
>&#13;Comma separated list of prognostic mozart species packages.
Currently available: <CODE
CLASS="constant"
>DST,SSLT,SO4,GHG,OC,BC,CARBON16</CODE
>
</P
></DD
><DT
><CODE
CLASS="option"
>-rad</CODE
> [<CODE
CLASS="constant"
>rrtmg</CODE
>
    | <CODE
CLASS="constant"
>camrt</CODE
>]</DT
><DD
><P
>&#13;Radiation package.
Default: <CODE
CLASS="constant"
>rrtmg</CODE
> if the physics package
is <CODE
CLASS="constant"
>cam5</CODE
>, otherwise <CODE
CLASS="constant"
>camrt</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-usr_mech_infile</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Pathname of the user supplied chemistry mechanism file.
</P
></DD
><DT
><CODE
CLASS="option"
>-waccm_phys</CODE
></DT
><DD
><P
>&#13;Switch enables the use of WACCM physics in any chemistry configuration.  
Default: Off.  If one of the waccm chemistry options is chosen then
it's automatically turned on.
</P
></DD
><DT
><CODE
CLASS="option"
>-waccmx</CODE
></DT
><DD
><P
>&#13;Build CAM/WACCM with WACCM upper Thermosphere/Ionosphere extended package.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_scam"
>SCAM configuration</A
></H3
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-camiop</CODE
></DT
><DD
><P
>&#13;Configure <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to generate an IOP file that can be used to drive SCAM.
This switch only works with the Eulerian dycore.
</P
></DD
><DT
><CODE
CLASS="option"
>-scam</CODE
></DT
><DD
><P
>&#13;Compiles model in single column mode.  Only works with Eulerian dycore.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_parallel"
>CAM parallelization</A
></H3
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-ntasks</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;This option must be used to specify <ACRONYM
CLASS="acronym"
>SPMD</ACRONYM
> parallelism when the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
component is present.  <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
> is the
number of <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> tasks.  Setting ntasks &#62; 0 implies -spmd.  Use -nospmd to turn off
linking with an MPI library.  To configure for pure <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> specify "-ntasks N -nosmp".
ntasks is used by <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> to determine default grid decompositions which
must be specified at build time.
</P
></DD
><DT
><CODE
CLASS="option"
>-nthreads</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;This option must be used to specify <ACRONYM
CLASS="acronym"
>SMP</ACRONYM
> parallelism when the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
component is present.  <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
> is the
number of <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
> threads per process.  Setting nthreads &#62; 0 implies -smp.  Use -nosmp to
turn off compilation of OMP directives.  For pure <ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
> set "-nthreads N -nospmd"
nthreads is used by <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> to determine default grid decomposition which
must be specified at build time.
</P
></DD
><DT
><CODE
CLASS="option"
>-[no]smp</CODE
></DT
><DD
><P
>&#13;Switch on [off] SMP parallelism (<ACRONYM
CLASS="acronym"
>OpenMP</ACRONYM
>).  This option can be used when
building a model that doesn't contain <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>.  It allows building an
executable whose thread count can be set at run time.
</P
></DD
><DT
><CODE
CLASS="option"
>-[no]spmd</CODE
></DT
><DD
><P
>&#13;Switch on [off] SPMD parallelism (<ACRONYM
CLASS="acronym"
>MPI</ACRONYM
>).  This option can be used when
building a model that doesn't contain <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>.  It allows building an
executable whose task count can be set at run time.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_cice"
>CICE decomposition</A
></H3
><P
>&#13;<I
CLASS="emphasis"
>When <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is running standalone with <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> the default <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
  decomposition is determined from the values of
  the <CODE
CLASS="option"
>-ntasks</CODE
> and <CODE
CLASS="option"
>-nthreads</CODE
> arguments.
  The user also has the ability to explicitly set the <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
>
  decomposition using the following arguments:</I
>
<DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
*** All four of these arguments must be set. ***
</P
></BLOCKQUOTE
></DIV
>
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-cice_bsizex</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;<ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> block size in longitude dimension.  This size must evenly
divide the number of longitude points in the global grid.
</P
></DD
><DT
><CODE
CLASS="option"
>-cice_bsizey</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;<ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> block size in latitude dimension.  This size must evenly
divide the number of latitude points in the global grid.
</P
></DD
><DT
><CODE
CLASS="option"
>-cice_maxblocks</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Maximum number of <ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> blocks per process.
</P
></DD
><DT
><CODE
CLASS="option"
>-cice_decomptype</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;<ACRONYM
CLASS="acronym"
>CICE</ACRONYM
> decomposition type [ <CODE
CLASS="constant"
>cartesian</CODE
> | <CODE
CLASS="constant"
>spacecurve</CODE
> |
<CODE
CLASS="constant"
>roundrobin</CODE
> ].
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_general"
>General options</A
></H3
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-cache</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Name of output cache file.  Default: <TT
CLASS="filename"
>config_cache.xml</TT
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-cachedir</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Name of directory where output cache file is written.  Default: <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> build directory.
</P
></DD
><DT
><CODE
CLASS="option"
>-ccsm_seq</CODE
></DT
><DD
><P
>&#13;Switch to specify that <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> is being built from within the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
>
scripts.  This produces Filepath and CCSM_cppdefs files that contains only
the paths and CPP macros needed to build a library for the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> component.
</P
></DD
><DT
><CODE
CLASS="option"
>-defaults</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Specify a configuration file which will be used to supply defaults instead of
one of the <TT
CLASS="filename"
>config_files/defaults_*.xml</TT
> files.  This file is used to specify model
configuration parameters only.  Parameters relating to the build which
are system dependent will be ignored.
</P
></DD
><DT
><CODE
CLASS="option"
>-help | -h</CODE
></DT
><DD
><P
>&#13;Print usage to STDOUT.
</P
></DD
><DT
><CODE
CLASS="option"
>-silent | -s</CODE
></DT
><DD
><P
>&#13;Turns on silent mode - only fatal messages printed to STDOUT.
</P
></DD
><DT
><A
NAME="cfg_test"
></A
><CODE
CLASS="option"
>-test</CODE
></DT
><DD
><P
>&#13;Switch on testing of Fortran compiler and linking to external libraries.
</P
></DD
><DT
><CODE
CLASS="option"
>-verbose | -v</CODE
></DT
><DD
><P
>&#13;Turn on verbose echoing of settings made by configure.
</P
></DD
><DT
><CODE
CLASS="option"
>-version</CODE
></DT
><DD
><P
>&#13;Echo the repository tag name used to check out this <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> source tree.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_surface_comp"
>Surface components</A
></H3
><P
>&#13;<I
CLASS="emphasis"
>Options for surface components used in standalone CAM mode:</I
>
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-ice</CODE
> [<CODE
CLASS="constant"
>cice</CODE
> |
 <CODE
CLASS="constant"
>sice</CODE
> ]</DT
><DD
><P
>&#13;Specify the sea ice component.
Default: <CODE
CLASS="constant"
>cice</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-lnd</CODE
> [<CODE
CLASS="constant"
>clm</CODE
> |
 <CODE
CLASS="constant"
>slnd</CODE
> ]</DT
><DD
><P
>&#13;Specify the land component.
Default: <CODE
CLASS="constant"
>clm</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-ocn</CODE
>
[<CODE
CLASS="constant"
>docn</CODE
> | <CODE
CLASS="constant"
>socn</CODE
> |
<CODE
CLASS="constant"
>dom</CODE
> | <CODE
CLASS="constant"
>aquaplanet</CODE
> ]</DT
><DD
><P
>&#13;Specify ocean component.  If set to <CODE
CLASS="constant"
>aquaplanet</CODE
> then
the stub ice (<CODE
CLASS="constant"
>sice</CODE
>) and stubb land
(<CODE
CLASS="constant"
>slnd</CODE
>)  components are implied.
Default: <CODE
CLASS="constant"
>docn</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-rof</CODE
> [<CODE
CLASS="constant"
>rtm</CODE
> |
 <CODE
CLASS="constant"
>srof</CODE
> ]</DT
><DD
><P
>&#13;Specify the river runoff component.
Default: <CODE
CLASS="constant"
>rtm</CODE
>.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="config_standalone_bld"
>CAM standalone build</A
></H3
><P
>&#13;<I
CLASS="emphasis"
>Options for building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> via standalone scripts:</I
>
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><A
NAME="cam_bld"
></A
><CODE
CLASS="option"
>-cam_bld</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory where <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> will be built.  This is where configure will write the
output files it generates (Makefile, Filepath, etc...).  Default: ./
</P
></DD
><DT
><CODE
CLASS="option"
>-cam_exe</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Name of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> executable.  Default: <CODE
CLASS="constant"
>cam</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-cam_exedir</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory where CAM executable will be created.  Default: CAM build directory.
</P
></DD
><DT
><CODE
CLASS="option"
>-cc</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;User specified C compiler.  Default: Depends on the OS
and the Fortran compiler.
</P
></DD
><DT
><CODE
CLASS="option"
>-cflags</CODE
> <KBD
CLASS="userinput"
>&#60;string&#62;</KBD
></DT
><DD
><P
>&#13;A string of user specified C compiler options appended to the default
options set in Makefile.
</P
></DD
><DT
><CODE
CLASS="option"
>-debug</CODE
></DT
><DD
><P
>&#13;Switch to turn on building <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> with compiler options for debugging.  The
specific options are compiler dependent.  These flags are set in the
<TT
CLASS="filename"
>Makefile.in</TT
> template file.
</P
></DD
><DT
><CODE
CLASS="option"
>-esmf_libdir</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>ESMF</ACRONYM
> library and the <TT
CLASS="filename"
>esmf.mk</TT
>
file.  If this option is specified then the external <ACRONYM
CLASS="acronym"
>ESMF</ACRONYM
> library will be
used in place of the ESMF-WRF time manager code which is provided in the
CESM source distribution.
</P
></DD
><DT
><CODE
CLASS="option"
>-fc</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;User specified <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler.  Default: Depends on
the OS and whether MPI is enabled.
</P
></DD
><DT
><CODE
CLASS="option"
>-fc_type</CODE
>
[<CODE
CLASS="constant"
>pgi</CODE
> | <CODE
CLASS="constant"
>lahey</CODE
> |
<CODE
CLASS="constant"
>intel</CODE
> | <CODE
CLASS="constant"
>pathscale</CODE
> |
<CODE
CLASS="constant"
>gnu</CODE
> | <CODE
CLASS="constant"
>xlf</CODE
>]</DT
><DD
><P
>&#13;
Type of the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler.  This argument is used in conjunction with
the <CODE
CLASS="option"
>-fc</CODE
> argument when the name of the fortran compiler
refers to a wrapper script (e.g., mpif90 or ftn).  In this case the user
needs to specify the type of <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler that is being invoked by the
wrapper script.
Default: Depends on the name of the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler.
</P
></DD
><DT
><CODE
CLASS="option"
>-fflags</CODE
> <KBD
CLASS="userinput"
>&#60;string&#62;</KBD
></DT
><DD
><P
>&#13;A string of user specified <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler options appended to the
default options set in the Makefile.
See <A
HREF="#cfg_fopt"
><CODE
CLASS="option"
>-fopt</CODE
></A
> to override optimization flags.
</P
></DD
><DT
><A
NAME="cfg_fopt"
></A
><CODE
CLASS="option"
>-fopt</CODE
> <KBD
CLASS="userinput"
>&#60;string&#62;</KBD
></DT
><DD
><P
>&#13;A string of user specified <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler optimization flags.  
Overrides Makefile defaults.
</P
></DD
><DT
><CODE
CLASS="option"
>-gmake</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Name of the <ACRONYM
CLASS="acronym"
>GNU</ACRONYM
> make program on your system.  Supply the absolute
pathname if the program is not in your path (or fix your path).  This is
only needed by <B
CLASS="command"
>configure</B
> for running tests via the
<A
HREF="#cfg_test"
><CODE
CLASS="option"
>-test</CODE
></A
> option.
</P
></DD
><DT
><CODE
CLASS="option"
>-lapack_libdir</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>LAPACK</ACRONYM
> library.
</P
></DD
><DT
><CODE
CLASS="option"
>-ldflags</CODE
> <KBD
CLASS="userinput"
>&#60;string&#62;</KBD
></DT
><DD
><P
>&#13;A string of user specified load options.  Appended to
Makefile defaults.
</P
></DD
><DT
><CODE
CLASS="option"
>-linker</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;User specified linker.  Default: use the <ACRONYM
CLASS="acronym"
>Fortran</ACRONYM
> compiler.
</P
></DD
><DT
><CODE
CLASS="option"
>-mpi_inc</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> include files.
</P
></DD
><DT
><CODE
CLASS="option"
>-mpi_lib</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>MPI</ACRONYM
> library.
</P
></DD
><DT
><CODE
CLASS="option"
>-nc_inc</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> include files.
</P
></DD
><DT
><CODE
CLASS="option"
>-nc_lib</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> library.
</P
></DD
><DT
><CODE
CLASS="option"
>-nc_mod</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>NetCDF</ACRONYM
> module files.
</P
></DD
><DT
><CODE
CLASS="option"
>-pnc_inc</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>PnetCDF</ACRONYM
> include files.
</P
></DD
><DT
><CODE
CLASS="option"
>-pnc_lib</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory containing <ACRONYM
CLASS="acronym"
>PnetCDF</ACRONYM
> library.
</P
></DD
><DT
><CODE
CLASS="option"
>-rad_driver</CODE
></DT
><DD
><P
>&#13;Build <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> with the offline radiation driver.  This produces an executable
that can only be used for offline radiation calculations.
</P
></DD
><DT
><CODE
CLASS="option"
>-target_os</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Override the OS setting for cross platform compilation from the following
 list
 [<CODE
CLASS="constant"
>aix</CODE
>|<CODE
CLASS="constant"
>irix</CODE
>|<CODE
CLASS="constant"
>linux</CODE
>|
 <CODE
CLASS="constant"
>bgl</CODE
>|<CODE
CLASS="constant"
>bgp</CODE
> ].
  Default: OS on which configure is executed as defined by the <ACRONYM
CLASS="acronym"
>Perl</ACRONYM
> $OSNAME variable.
</P
></DD
><DT
><CODE
CLASS="option"
>-usr_src</CODE
> <KBD
CLASS="userinput"
>&#60;dir1&#62;[,&#60;dir2&#62;[,&#60;dir3&#62;[...]]]</KBD
></DT
><DD
><P
>&#13;Directories containing user source code.  Note that these directories will
also be searched for modified versions of
the files needed by the <B
CLASS="command"
>build-namelist</B
> script, e.g., the namelist definition and
use case files.
</P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="config_env"
>Environment variables recognized by <B
CLASS="command"
>configure</B
></A
></H2
><P
>&#13;The following environment variables are recognized by <B
CLASS="command"
>configure</B
>.  Note
that the command line arguments for specifying this information always
takes precedence over the environment variables.
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="envar"
>CASEROOT</CODE
></DT
><DD
><P
>&#13;Directory where a <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> case is set up.  This is only used when building
from the CESM scripts to add the SourceMods directory for <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> to
the <TT
CLASS="filename"
>Filepath</TT
> file.
</P
></DD
><DT
><CODE
CLASS="envar"
>ESMF_LIBDIR</CODE
></DT
><DD
><P
>&#13;Directory containing the ESMF library.
</P
></DD
><DT
><CODE
CLASS="envar"
>INC_MPI</CODE
></DT
><DD
><P
>&#13;Directory containing the MPI include files.
</P
></DD
><DT
><CODE
CLASS="envar"
>INC_NETCDF</CODE
></DT
><DD
><P
>&#13;Directory containing the NetCDF include files.
</P
></DD
><DT
><CODE
CLASS="envar"
>INC_PNETCDF</CODE
></DT
><DD
><P
>&#13;Directory containing the PnetCDF include files.
</P
></DD
><DT
><CODE
CLASS="envar"
>LAPACK_LIBDIR</CODE
></DT
><DD
><P
>&#13;Directory containing the LAPACK library.
</P
></DD
><DT
><CODE
CLASS="envar"
>LIB_MPI</CODE
></DT
><DD
><P
>&#13;Directory containing the MPI library.
</P
></DD
><DT
><CODE
CLASS="envar"
>LIB_NETCDF</CODE
></DT
><DD
><P
>&#13;Directory containing the NetCDF library.
</P
></DD
><DT
><CODE
CLASS="envar"
>LIB_PNETCDF</CODE
></DT
><DD
><P
>&#13;Directory containing the PnetCDF library.
</P
></DD
><DT
><CODE
CLASS="envar"
>MCT_LIBDIR</CODE
></DT
><DD
><P
>&#13;Directory containing the MCT libraries.
</P
></DD
><DT
><CODE
CLASS="envar"
>MOD_NETCDF</CODE
></DT
><DD
><P
>&#13;Directory containing the NetCDF module files.
</P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="bldnl"
></A
>Appendix B. The <B
CLASS="command"
>build-namelist</B
> utility</H1
><P
>&#13;The <B
CLASS="command"
>build-namelist</B
> utility builds namelists (and on occasion other types of input
files) which specify run-time details for <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> and the components it's
running with in standalone mode.  When executed from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> scripts it
only produces a namelist file for the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> component (in the file
<TT
CLASS="filename"
>atm_in</TT
>), and a namelist file for control of dry deposition which is shared
by <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> and <ACRONYM
CLASS="acronym"
>CLM</ACRONYM
> (in the file <TT
CLASS="filename"
>drv_flds_in</TT
>).
</P
><P
>&#13;The task of constructing a correct namelist has become extremely complex
due to the large number of configurations supported by <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
>.  Editing
namelists by hand is an extremely fragile process due to the number of
variables that need to be set, and to the many interdependencies among
them.  <I
CLASS="emphasis"
>We do not recommend editing namelists by hand.</I
>
All customizations of the <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> namelist are possible by making use of the
<B
CLASS="command"
>build-namelist</B
> command line options.
</P
><P
>&#13;Some of the important features of <B
CLASS="command"
>build-namelist</B
> are:
<P
></P
><UL
><LI
><P
>&#13;
All valid namelist variables are known to <B
CLASS="command"
>build-namelist</B
>.  So an invalid
variable specified by the user (supplied either by the
<CODE
CLASS="option"
>-infile</CODE
> or <CODE
CLASS="option"
>-namelist</CODE
> options) will cause
<B
CLASS="command"
>build-namelist</B
> to fail with an error message telling which namelist
variable is invalid.  This is a big improvement over a runtime failure
caused by an invalid variable which typically gives no hint as to which
variable caused the problem.
</P
></LI
><LI
><P
>&#13;In addition to knowing all valid variable names and their
types, <B
CLASS="command"
>build-namelist</B
> also knows which namelist group each variable belongs to.
This means that the user only needs to specify variable names to <B
CLASS="command"
>build-namelist</B
>
and not the group names.  The <CODE
CLASS="option"
>-infile</CODE
>
and <CODE
CLASS="option"
>-namelist</CODE
> options still require valid namelist syntax
as input, but the group name is ignored.  So all variables can be put
in a single group with an arbitrary name, for example, "&#38;xxx ... /".
</P
></LI
><LI
><P
>&#13;Since <B
CLASS="command"
>build-namelist</B
> knows all namelist variables specified by the user it is able
to do consistency checking.  In general however, <B
CLASS="command"
>build-namelist</B
> assumes that the
user is the expert and will not override a user specification unless there
is a major inconsistency, for example if variables have been set to use
parameterizations which can not be run at the same time.
</P
></LI
><LI
><P
>&#13;All configurations have namelist variables that must be specified, and
<B
CLASS="command"
>build-namelist</B
> has a mechanism to provide default values for these variables.
When an appropriate default value cannot be found then <B
CLASS="command"
>build-namelist</B
> will fail
with an informative message.
</P
></LI
><LI
><P
>&#13;When running a configuration for the first time there are often many input
datasets that may not be in the local input data directory.  In order to
facilitate getting the required datasets <B
CLASS="command"
>build-namelist</B
> has an
option, <CODE
CLASS="option"
>-test</CODE
>, that can be used to produce a complete list
of required datasets and report status of whether or not they are present
in the local directory.  This list can then be used to obtain the needed
datasets from the <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> SVN input data repository.
</P
></LI
></UL
>


</P
><P
>&#13;One required input for <B
CLASS="command"
>build-namelist</B
> is a configuration
cache file produced by a previous invocation of <B
CLASS="command"
>configure</B
>
(<TT
CLASS="filename"
>config_cache.xml</TT
> by default).  <B
CLASS="command"
>build-namelist</B
> looks
at this file to determine the features of the CAM executable, such as
the dynamical core and horizontal resolution, that affect the default
specifications for namelist variables.  The default values themselves
are specified in the file
<TT
CLASS="filename"
>$CAM_ROOT/models/atm/cam/bld/namelist_files/namelist_defaults_cam.xml</TT
>,
and in the use case files located in the directory
<TT
CLASS="filename"
>$CAM_ROOT/models/atm/cam/bld/namelist_files/use_cases/</TT
>.
</P
><P
>&#13;The other required input for <B
CLASS="command"
>build-namelist</B
> is the root directory for the input
datasets.  This is required since nearly all input files must be specified
using absolute filepaths, but the defaults are stored as filepaths which
are relative to the root directory.  It is expected that the actual
location of the root directory is something that will be resolved at
runtime.  The way this is done is to either specify it using
the <CODE
CLASS="option"
>-csmdata</CODE
> argument, or to set the environment variable
<CODE
CLASS="envar"
>CSMDATA</CODE
>.
</P
><P
>&#13;The methods for setting the values of namelist variables, listed from
highest to lowest precedence, are:
</P
><P
></P
><OL
TYPE="1"
><LI
><P
>&#13;using specific command-line options,
e.g., <CODE
CLASS="option"
>-case</CODE
> and <CODE
CLASS="option"
>-runtype</CODE
>,
</P
></LI
><LI
><P
>&#13;using the <CODE
CLASS="option"
>-namelist</CODE
> option,
</P
></LI
><LI
><P
>&#13;setting values in a file specified by <CODE
CLASS="option"
>-infile</CODE
>,
</P
></LI
><LI
><P
>&#13;specifying a <CODE
CLASS="option"
>-use_case</CODE
> option,
</P
></LI
><LI
><P
>&#13;setting values in the namelist defaults file.
</P
></LI
></OL
><P
>&#13;The first four of these methods for specifying namelist variables are
the ones available to the user without requiring code modification.  Any
namelist variable recognized by <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> can be modified using method 2 or 3.
The final two methods represent defaults that are hard coded as part of the
code base.
</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="bldnl_opts"
>Options to <B
CLASS="command"
>build-namelist</B
></A
></H2
><P
>&#13;To get a list of all available options, type <KBD
CLASS="userinput"
>build-namelist --help</KBD
>.
Available options are also listed just below.
</P
><P
>&#13;The following options may all be specified with either one or two leading
dashes, e.g., <CODE
CLASS="option"
>-help</CODE
> or <CODE
CLASS="option"
>--help</CODE
>.  The few
options that can be expressed as single letter switches may not be clumped,
e.g., <CODE
CLASS="option"
>-h -s -v</CODE
> may <I
CLASS="emphasis"
>NOT</I
> be expressed
as <CODE
CLASS="option"
>-hsv</CODE
>.  When multiple options are listed separated by a
vertical bar either version may be used.
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="option"
>-case</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Case identifier up to 80 characters.  This value is used to set the
case_name variable in the driver namelist.  Default: <CODE
CLASS="constant"
>camrun</CODE
>
</P
></DD
><DT
><CODE
CLASS="option"
>-cice_nl</CODE
> <KBD
CLASS="userinput"
>&#60;namelist&#62;</KBD
></DT
><DD
><P
>&#13;Specify namelist settings for CICE directly on the commandline by supplying 
a string containing FORTRAN namelist syntax, e.g.,
<KBD
CLASS="userinput"
>-cice_nl "&#38;ice histfreq=1 /"</KBD
>.
This namelist will be passed to the invocation of the CICE build-namelist
via its <CODE
CLASS="option"
>-namelist</CODE
> argument.
</P
></DD
><DT
><CODE
CLASS="option"
>-config</CODE
> <KBD
CLASS="userinput"
>&#60;filepath&#62;</KBD
></DT
><DD
><P
>&#13;Read the specified configuration cache file to determine the configuration
of the CAM executable.  Default: <TT
CLASS="filename"
>config_cache.xml</TT
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-config_cice</CODE
> <KBD
CLASS="userinput"
>&#60;filepath&#62;</KBD
></DT
><DD
><P
>&#13;Filepath of the CICE config_cache file.  This filepath is passed to the
invocation of the CICE <B
CLASS="command"
>build-namelist</B
>.  Only specify this to override the
default filepath which was set when the CICE <B
CLASS="command"
>configure</B
> was invoked by
the CAM <B
CLASS="command"
>configure</B
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-csmdata</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Root directory of <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> input data.
Can also be set by using the <CODE
CLASS="envar"
>CSMDATA</CODE
> environment variable.
</P
></DD
><DT
><CODE
CLASS="option"
>-dir</CODE
> <KBD
CLASS="userinput"
>&#60;dir&#62;</KBD
></DT
><DD
><P
>&#13;Directory where output namelist files for each component will be
written, i.e., <TT
CLASS="filename"
>atm_in</TT
>, <TT
CLASS="filename"
>drv_in</TT
>,
<TT
CLASS="filename"
>ice_in</TT
>, <TT
CLASS="filename"
>lnd_in</TT
> and <TT
CLASS="filename"
>ocn_in</TT
>.
Default: current working directory.
</P
></DD
><DT
><CODE
CLASS="option"
>-help | -h</CODE
></DT
><DD
><P
>&#13;Print usage to STDOUT.
</P
></DD
><DT
><CODE
CLASS="option"
>-ignore_ic_date</CODE
></DT
><DD
><P
>&#13;Ignore the date attribute of the initial condition files
when determining the default.
</P
></DD
><DT
><CODE
CLASS="option"
>-ignore_ic_year</CODE
></DT
><DD
><P
>&#13;Ignore just the year part of the date attribute of the initial condition files
when determining the default.
</P
></DD
><DT
><CODE
CLASS="option"
>-infile</CODE
> <KBD
CLASS="userinput"
>&#60;filepath&#62;</KBD
></DT
><DD
><P
>&#13;Specify a file containing namelists to read values from.
</P
></DD
><DT
><CODE
CLASS="option"
>-inputdata</CODE
> <KBD
CLASS="userinput"
>&#60;filepath&#62;</KBD
></DT
><DD
><P
>&#13;Writes out a list of pathnames for required input datasets to
the specified file.
</P
></DD
><DT
><CODE
CLASS="option"
>-namelist</CODE
> <KBD
CLASS="userinput"
>&#60;namelist&#62;</KBD
></DT
><DD
><P
>&#13;Specify namelist settings directly on the commandline by supplying 
a string containing FORTRAN namelist syntax, e.g.,
<KBD
CLASS="userinput"
>-namelist "&#38;atm stop_option='ndays' stop_n=10 /"</KBD
>
</P
></DD
><DT
><CODE
CLASS="option"
>-ntasks</CODE
> <KBD
CLASS="userinput"
>&#60;n&#62;</KBD
></DT
><DD
><P
>&#13;Specify the number of MPI tasks to be used by the run.  This is only used
to set a default decomposition for the FV dycore, i.e., the npr_yz variable.
</P
></DD
><DT
><CODE
CLASS="option"
>-runtype</CODE
>
[<CODE
CLASS="constant"
>startup</CODE
>|<CODE
CLASS="constant"
>continue</CODE
>|<CODE
CLASS="constant"
>branch</CODE
>]</DT
><DD
><P
>&#13;Type of simulation.  Default: <CODE
CLASS="constant"
>startup</CODE
>.
</P
></DD
><DT
><CODE
CLASS="option"
>-silent | -s</CODE
></DT
><DD
><P
>&#13;Turns on silent mode - only fatal messages issued.
</P
></DD
><DT
><CODE
CLASS="option"
>-test</CODE
></DT
><DD
><P
>&#13;Enable checking that input datasets exist on local filesystem.  This is
also a convenient way to generate a list of the required input datasets for
a model run.
</P
></DD
><DT
><CODE
CLASS="option"
>-use_case</CODE
> <KBD
CLASS="userinput"
>&#60;name&#62;</KBD
></DT
><DD
><P
>&#13;Specify a use case.
</P
></DD
><DT
><CODE
CLASS="option"
>-verbose | -v</CODE
></DT
><DD
><P
>&#13;Turn on verbose echoing of informational messages.
</P
></DD
><DT
><CODE
CLASS="option"
>-version</CODE
></DT
><DD
><P
>&#13;Echo the source code repository tag name used to check out this CAM distribution.
</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="bldnl_env"
>Environment variables used by <B
CLASS="command"
>build-namelist</B
></A
></H2
><P
>&#13;The environment variables recognized by <B
CLASS="command"
>build-namelist</B
> are
presented below.
</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><CODE
CLASS="envar"
>CSMDATA</CODE
></DT
><DD
><P
>&#13;Root directory of <ACRONYM
CLASS="acronym"
>CESM</ACRONYM
> input data.
Note that the commandline argument <CODE
CLASS="option"
>-csmdata</CODE
> takes
precedence over the environment variable.
</P
></DD
><DT
><CODE
CLASS="envar"
>OMP_NUM_THREADS</CODE
></DT
><DD
><P
>&#13;If values of the specific variables that set the thread count for each
component, i.e., <KBD
CLASS="userinput"
>atm_nthreads</KBD
>, <KBD
CLASS="userinput"
>cpl_nthreads</KBD
>,
<KBD
CLASS="userinput"
>ice_nthreads</KBD
>, <KBD
CLASS="userinput"
>lnd_nthreads</KBD
>,
or <KBD
CLASS="userinput"
>ocn_nthreads</KBD
>, are set via
the <CODE
CLASS="option"
>-namelist</CODE
>, or <CODE
CLASS="option"
>-infile</CODE
> options, then
these values have highest precedence.  The <CODE
CLASS="envar"
>OMP_NUM_THREADS</CODE
>
environment variable has next highest precedence for setting any of the
component specific thread count variables.  Lowest precedence for setting
these variables is the value of <CODE
CLASS="option"
>nthreads</CODE
> from the configure cache file.
</P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="cam_namelist_ref"
></A
>Appendix C. <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> Namelist Variables</H1
><P
>&#13;A <ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> model run is controlled using the <B
CLASS="command"
>build-namelist</B
> facility
described in <A
HREF="#bldnl"
>Appendix B</A
>.  The focus of this appendix
is to provide a reference for the variables that may be set through the use of
<B
CLASS="command"
>build-namelist</B
>.  A searchable (or browsable) page is also available 
<A
HREF="../../../../../cgi-bin/eaton/namelist/nldef2html-cam5_2/default.htm"
TARGET="_top"
>here</A
>, or
by following
the "Search Namelist Variables" link under the Documentation section of the
<A
HREF="../../../../../www.cesm.ucar.edu/models/cesm1.1/cam/default.htm"
TARGET="_top"
><ACRONYM
CLASS="acronym"
>CAM</ACRONYM
> home page</A
>.
</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
The table version of the variables is not yet ready.
</P
></BLOCKQUOTE
></DIV
></DIV
></DIV
></BODY
></HTML
>